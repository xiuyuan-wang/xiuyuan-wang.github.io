(window.webpackJsonp=window.webpackJsonp||[]).push([[92],{288:function(n,s,e){"use strict";e.r(s);var a=e(14),r=Object(a.a)({},(function(){var n=this,s=n._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":n.$parent.slotKey}},[s("h3",{attrs:{id:"前言"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[n._v("#")]),n._v(" 前言")]),n._v(" "),s("p",[n._v("上篇文章我们分享了关于 "),s("code",[n._v("用户行为监控")]),n._v(" 的内容，本文我们接着来看 "),s("code",[n._v("错误异常监控")]),n._v(" 的方面")]),n._v(" "),s("h3",{attrs:{id:"系列文章传送门"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#系列文章传送门"}},[n._v("#")]),n._v(" 系列文章传送门")]),n._v(" "),s("p",[s("a",{attrs:{href:"https://juejin.cn/post/7097157902862909471",title:"https://juejin.cn/post/7097157902862909471",target:"_blank",rel:"noopener noreferrer"}},[n._v("一文摸清前端监控实践要点（一）性能监控"),s("OutboundLink")],1)]),n._v(" "),s("p",[s("a",{attrs:{href:"https://juejin.cn/post/7098656658649251877",title:"https://juejin.cn/post/7098656658649251877",target:"_blank",rel:"noopener noreferrer"}},[n._v("一文摸清前端监控实践要点（二）行为监控"),s("OutboundLink")],1)]),n._v(" "),s("p",[s("a",{attrs:{href:"https://juejin.cn/post/7100841779854835719/",title:"https://juejin.cn/post/7100841779854835719/",target:"_blank",rel:"noopener noreferrer"}},[n._v("一文摸清前端监控实践要点（三）错误监控"),s("OutboundLink")],1)]),n._v(" "),s("p",[s("a",{attrs:{href:"https://juejin.cn/post/7108660942686126093",title:"https://juejin.cn/post/7108660942686126093",target:"_blank",rel:"noopener noreferrer"}},[n._v("腾讯三面：说说前端监控告警分析平台的架构设计和难点亮点？"),s("OutboundLink")],1)]),n._v(" "),s("h3",{attrs:{id:"应用的稳定情况"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#应用的稳定情况"}},[n._v("#")]),n._v(" 应用的稳定情况")]),n._v(" "),s("p",[n._v("众所周知，无论进行发布前的"),s("code",[n._v("单元测试")]),n._v("、"),s("code",[n._v("集成测试")]),n._v("、"),s("code",[n._v("人工测试")]),n._v("进行再多轮，"),s("strong",[n._v("都会难免漏掉一些边缘的测试场景")]),n._v("，甚至还有一些"),s("code",[n._v("奇奇怪怪的玄学故障出现")]),n._v("；而出现报错后，"),s("code",[n._v("轻则某些数据页面无法访问")]),n._v("，"),s("code",[n._v("重则导致客户数据出错")]),n._v("；")]),n._v(" "),s("p",[n._v("这时，一个完善的错误监控体系就派上很大的用场，它可以帮助我们做以下的事情：")]),n._v(" "),s("ul",[s("li",[n._v("应用报错时，及时知晓线上应用出现了错误，及时安排修复止损；")]),n._v(" "),s("li",[n._v("应用报错后，根据上报的用户行为追踪记录数据，迅速进行bug复现；")]),n._v(" "),s("li",[n._v("应用报错后，通过上报的错误行列以及错误信息，找到报错源码并快速修正；")]),n._v(" "),s("li",[n._v("数据采集后，进行分析提供宏观的 错误数、错误率、影响用户数等关键指标；")])]),n._v(" "),s("h4",{attrs:{id:"整体封装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#整体封装"}},[n._v("#")]),n._v(" 整体封装")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("// 错误类型\nexport enum mechanismType {\n  JS = 'js',\n  RS = 'resource',\n  UJ = 'unhandledrejection',\n  HP = 'http',\n  CS = 'cors',\n  VUE = 'vue',\n}\n\n// 格式化后的 异常数据结构体\nexport interface ExceptionMetrics {\n  mechanism: Object;\n  value?: string;\n  type: string;\n  stackTrace?: Object;\n  pageInformation?: Object;\n  breadcrumbs?: Array<behaviorStack>;\n  errorUid: string;\n  meta?: any;\n}\n\n// 初始化用参\nexport interface ErrorVitalsInitOptions {\n  Vue: any;\n}\n\n// 判断是 JS异常、静态资源异常、还是跨域异常\nexport const getErrorKey = (event: ErrorEvent | Event) => {\n  const isJsError = event instanceof ErrorEvent;\n  if (!isJsError) return mechanismType.RS;\n  return event.message === 'Script error.' ? mechanismType.CS : mechanismType.JS;\n};\n\n// 初始化的类\nexport default class ErrorVitals {\n  private engineInstance: EngineInstance;\n\n  // 已上报的错误 uid\n  private submitErrorUids: Array<string>;\n\n  constructor(engineInstance: EngineInstance, options: ErrorVitalsInitOptions) {\n    const { Vue } = options;\n    this.engineInstance = engineInstance;\n    this.submitErrorUids = [];\n    // 初始化 js错误\n    this.initJsError();\n    // 初始化 静态资源加载错误\n    this.initResourceError();\n    // 初始化 Promise异常\n    this.initPromiseError();\n    // 初始化 HTTP请求异常\n    this.initHttpError();\n    // 初始化 跨域异常\n    this.initCorsError();\n    // 初始化 Vue异常\n    this.initVueError(Vue);\n  }\n\n  // 封装错误的上报入口，上报前，判断错误是否已经发生过\n  errorSendHandler = (data: ExceptionMetrics) => {\n    // 统一加上 用户行为追踪 和 页面基本信息\n    const submitParams = {\n      ...data,\n      breadcrumbs: this.engineInstance.userInstance.breadcrumbs.get(),\n      pageInformation: this.engineInstance.userInstance.metrics.get('page-information'),\n    } as ExceptionMetrics;\n    // 判断同一个错误在本次页面访问中是否已经发生过;\n    const hasSubmitStatus = this.submitErrorUids.includes(submitParams.errorUid);\n    // 检查一下错误在本次页面访问中，是否已经产生过\n    if (hasSubmitStatus) return;\n    this.submitErrorUids.push(submitParams.errorUid);\n    // 记录后清除 breadcrumbs\n    this.engineInstance.userInstance.breadcrumbs.clear();\n    // 一般来说，有报错就立刻上报;\n    this.engineInstance.transportInstance.kernelTransportHandler(\n      this.engineInstance.transportInstance.formatTransportData(transportCategory.ERROR, submitParams),\n    );\n  };\n\n  // 初始化 JS异常 的数据获取和上报\n  initJsError = (): void => {\n    //... 详情代码在下\n  };\n\n  // 初始化 静态资源异常 的数据获取和上报\n  initResourceError = (): void => {\n    //... 详情代码在下\n  };\n\n  // 初始化 Promise异常 的数据获取和上报\n  initPromiseError = (): void => {\n    //... 详情代码在下\n  };\n\n  // 初始化 HTTP请求异常 的数据获取和上报\n  initHttpError = (): void => {\n    //... 详情代码在下\n  };\n\n  // 初始化 跨域异常 的数据获取和上报\n  initCorsError = (): void => {\n    //... 详情代码在下\n  };\n\n  // 初始化 Vue异常 的数据获取和上报\n  initVueError = (app: Vue): void => {\n    //... 详情代码在下\n  };\n}\n复制代码\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br"),s("span",{staticClass:"line-number"},[n._v("27")]),s("br"),s("span",{staticClass:"line-number"},[n._v("28")]),s("br"),s("span",{staticClass:"line-number"},[n._v("29")]),s("br"),s("span",{staticClass:"line-number"},[n._v("30")]),s("br"),s("span",{staticClass:"line-number"},[n._v("31")]),s("br"),s("span",{staticClass:"line-number"},[n._v("32")]),s("br"),s("span",{staticClass:"line-number"},[n._v("33")]),s("br"),s("span",{staticClass:"line-number"},[n._v("34")]),s("br"),s("span",{staticClass:"line-number"},[n._v("35")]),s("br"),s("span",{staticClass:"line-number"},[n._v("36")]),s("br"),s("span",{staticClass:"line-number"},[n._v("37")]),s("br"),s("span",{staticClass:"line-number"},[n._v("38")]),s("br"),s("span",{staticClass:"line-number"},[n._v("39")]),s("br"),s("span",{staticClass:"line-number"},[n._v("40")]),s("br"),s("span",{staticClass:"line-number"},[n._v("41")]),s("br"),s("span",{staticClass:"line-number"},[n._v("42")]),s("br"),s("span",{staticClass:"line-number"},[n._v("43")]),s("br"),s("span",{staticClass:"line-number"},[n._v("44")]),s("br"),s("span",{staticClass:"line-number"},[n._v("45")]),s("br"),s("span",{staticClass:"line-number"},[n._v("46")]),s("br"),s("span",{staticClass:"line-number"},[n._v("47")]),s("br"),s("span",{staticClass:"line-number"},[n._v("48")]),s("br"),s("span",{staticClass:"line-number"},[n._v("49")]),s("br"),s("span",{staticClass:"line-number"},[n._v("50")]),s("br"),s("span",{staticClass:"line-number"},[n._v("51")]),s("br"),s("span",{staticClass:"line-number"},[n._v("52")]),s("br"),s("span",{staticClass:"line-number"},[n._v("53")]),s("br"),s("span",{staticClass:"line-number"},[n._v("54")]),s("br"),s("span",{staticClass:"line-number"},[n._v("55")]),s("br"),s("span",{staticClass:"line-number"},[n._v("56")]),s("br"),s("span",{staticClass:"line-number"},[n._v("57")]),s("br"),s("span",{staticClass:"line-number"},[n._v("58")]),s("br"),s("span",{staticClass:"line-number"},[n._v("59")]),s("br"),s("span",{staticClass:"line-number"},[n._v("60")]),s("br"),s("span",{staticClass:"line-number"},[n._v("61")]),s("br"),s("span",{staticClass:"line-number"},[n._v("62")]),s("br"),s("span",{staticClass:"line-number"},[n._v("63")]),s("br"),s("span",{staticClass:"line-number"},[n._v("64")]),s("br"),s("span",{staticClass:"line-number"},[n._v("65")]),s("br"),s("span",{staticClass:"line-number"},[n._v("66")]),s("br"),s("span",{staticClass:"line-number"},[n._v("67")]),s("br"),s("span",{staticClass:"line-number"},[n._v("68")]),s("br"),s("span",{staticClass:"line-number"},[n._v("69")]),s("br"),s("span",{staticClass:"line-number"},[n._v("70")]),s("br"),s("span",{staticClass:"line-number"},[n._v("71")]),s("br"),s("span",{staticClass:"line-number"},[n._v("72")]),s("br"),s("span",{staticClass:"line-number"},[n._v("73")]),s("br"),s("span",{staticClass:"line-number"},[n._v("74")]),s("br"),s("span",{staticClass:"line-number"},[n._v("75")]),s("br"),s("span",{staticClass:"line-number"},[n._v("76")]),s("br"),s("span",{staticClass:"line-number"},[n._v("77")]),s("br"),s("span",{staticClass:"line-number"},[n._v("78")]),s("br"),s("span",{staticClass:"line-number"},[n._v("79")]),s("br"),s("span",{staticClass:"line-number"},[n._v("80")]),s("br"),s("span",{staticClass:"line-number"},[n._v("81")]),s("br"),s("span",{staticClass:"line-number"},[n._v("82")]),s("br"),s("span",{staticClass:"line-number"},[n._v("83")]),s("br"),s("span",{staticClass:"line-number"},[n._v("84")]),s("br"),s("span",{staticClass:"line-number"},[n._v("85")]),s("br"),s("span",{staticClass:"line-number"},[n._v("86")]),s("br"),s("span",{staticClass:"line-number"},[n._v("87")]),s("br"),s("span",{staticClass:"line-number"},[n._v("88")]),s("br"),s("span",{staticClass:"line-number"},[n._v("89")]),s("br"),s("span",{staticClass:"line-number"},[n._v("90")]),s("br"),s("span",{staticClass:"line-number"},[n._v("91")]),s("br"),s("span",{staticClass:"line-number"},[n._v("92")]),s("br"),s("span",{staticClass:"line-number"},[n._v("93")]),s("br"),s("span",{staticClass:"line-number"},[n._v("94")]),s("br"),s("span",{staticClass:"line-number"},[n._v("95")]),s("br"),s("span",{staticClass:"line-number"},[n._v("96")]),s("br"),s("span",{staticClass:"line-number"},[n._v("97")]),s("br"),s("span",{staticClass:"line-number"},[n._v("98")]),s("br"),s("span",{staticClass:"line-number"},[n._v("99")]),s("br"),s("span",{staticClass:"line-number"},[n._v("100")]),s("br"),s("span",{staticClass:"line-number"},[n._v("101")]),s("br"),s("span",{staticClass:"line-number"},[n._v("102")]),s("br"),s("span",{staticClass:"line-number"},[n._v("103")]),s("br"),s("span",{staticClass:"line-number"},[n._v("104")]),s("br"),s("span",{staticClass:"line-number"},[n._v("105")]),s("br"),s("span",{staticClass:"line-number"},[n._v("106")]),s("br"),s("span",{staticClass:"line-number"},[n._v("107")]),s("br"),s("span",{staticClass:"line-number"},[n._v("108")]),s("br"),s("span",{staticClass:"line-number"},[n._v("109")]),s("br"),s("span",{staticClass:"line-number"},[n._v("110")]),s("br"),s("span",{staticClass:"line-number"},[n._v("111")]),s("br")])]),s("h4",{attrs:{id:"生成错误-uid"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#生成错误-uid"}},[n._v("#")]),n._v(" 生成错误 uid")]),n._v(" "),s("p",[n._v("首先，什么叫为"),s("code",[n._v("每个错误生成 uid")]),n._v("，这里生成的 "),s("code",[n._v("uid")]),n._v(" 有什么用呢？答案其实很简单：")]),n._v(" "),s("ul",[s("li",[n._v("一次用户访问（页签未关闭），上报过一次错误后，后续产生"),s("code",[n._v("重复错误不再上报")])]),n._v(" "),s("li",[n._v("多个用户产生的同一个错误，在服务端可以归类，"),s("code",[n._v("分析影响用户数、错误数等指标")])]),n._v(" "),s("li",[n._v("需要注意的是，对于同一个原因产生的同一个错误，生成的 uid 是相同的")])]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("// 对每一个错误详情，生成一串编码\nexport const getErrorUid = (input: string) => {\n  return window.btoa(unescape(encodeURIComponent(input)));\n};\n复制代码\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br")])]),s("h4",{attrs:{id:"错误堆栈"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#错误堆栈"}},[n._v("#")]),n._v(" 错误堆栈")]),n._v(" "),s("p",[n._v("在做错误监控之前，我们先来了解一下什么是错误堆栈；我们写代码经常报错的时候能够看到，"),s("code",[n._v("下图这样子类似的错误")]),n._v("，一个错误加上很多条很多条的调用信息组成的错误；这就是抛出的 "),s("code",[n._v("Error对象")]),n._v(" 里的 "),s("code",[n._v("Stack错误堆栈")]),n._v("，里面包含了很多信息：包括"),s("code",[n._v("调用链")]),n._v("、"),s("code",[n._v("文件名")]),n._v("、"),s("code",[n._v("调用地址行列信息")]),n._v("等等；而在下文的错误捕获中，我们也需要去对 "),s("code",[n._v("Stack错误堆栈")]),n._v(" 进行解析；")]),n._v(" "),s("p",[s("img",{attrs:{src:"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4fc6084b2c604432ab8355e0c28bb530~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?",alt:"248666eeb9c549a7af8a57a6a5022077.png"}})]),n._v(" "),s("p",[s("strong",[n._v("当然，解析这一长串的东西还是比较痛苦的，我这边就给出我的解析方法"),s("code",[n._v("以供参考")]),n._v("：")])]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("// 正则表达式，用以解析堆栈split后得到的字符串\nconst FULL_MATCH =\n  /^\\s*at (?:(.*?) ?()?((?:file|https?|blob|chrome-extension|address|native|eval|webpack|<anonymous>|[-a-z]+:|.*bundle|/).*?)(?::(\\d+))?(?::(\\d+))?)?\\s*$/i;\n\n// 限制只追溯10个\nconst STACKTRACE_LIMIT = 10;\n\n// 解析每一行\nexport function parseStackLine(line: string) {\n  const lineMatch = line.match(FULL_MATCH);\n  if (!lineMatch) return {};\n  const filename = lineMatch[2];\n  const functionName = lineMatch[1] || '';\n  const lineno = parseInt(lineMatch[3], 10) || undefined;\n  const colno = parseInt(lineMatch[4], 10) || undefined;\n  return {\n    filename,\n    functionName,\n    lineno,\n    colno,\n  };\n}\n\n// 解析错误堆栈\nexport function parseStackFrames(error: Error) {\n  const { stack } = error;\n  // 无 stack 时直接返回\n  if (!stack) return [];\n  const frames = [];\n  for (const line of stack.split('\\n').slice(1)) {\n    const frame = parseStackLine(line);\n    if (frame) {\n      frames.push(frame);\n    }\n  }\n  return frames.slice(0, STACKTRACE_LIMIT);\n}\n复制代码\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br"),s("span",{staticClass:"line-number"},[n._v("27")]),s("br"),s("span",{staticClass:"line-number"},[n._v("28")]),s("br"),s("span",{staticClass:"line-number"},[n._v("29")]),s("br"),s("span",{staticClass:"line-number"},[n._v("30")]),s("br"),s("span",{staticClass:"line-number"},[n._v("31")]),s("br"),s("span",{staticClass:"line-number"},[n._v("32")]),s("br"),s("span",{staticClass:"line-number"},[n._v("33")]),s("br"),s("span",{staticClass:"line-number"},[n._v("34")]),s("br"),s("span",{staticClass:"line-number"},[n._v("35")]),s("br"),s("span",{staticClass:"line-number"},[n._v("36")]),s("br"),s("span",{staticClass:"line-number"},[n._v("37")]),s("br"),s("span",{staticClass:"line-number"},[n._v("38")]),s("br")])]),s("p",[n._v("调用 "),s("code",[n._v("parseStackFrames()")]),n._v(" 方法将 "),s("code",[n._v("error对象")]),n._v(" 传入后，我们可以看到解析的效果还是可以的：")]),n._v(" "),s("p",[s("img",{attrs:{src:"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/86b977a6c84f421b9660c3377d485c50~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?",alt:"image.png"}})]),n._v(" "),s("h4",{attrs:{id:"js运行异常"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#js运行异常"}},[n._v("#")]),n._v(" JS运行异常")]),n._v(" "),s("p",[n._v("什么叫 "),s("code",[n._v("JS运行异常")]),n._v(" 呢？其实很简单，当 "),s("strong",[n._v("JavaScript运行时产生的错误")]),n._v(" 就属于 "),s("code",[n._v("JS运行异常")])]),n._v(" "),s("p",[n._v("比如，我们未定义一个方法就直接调用它，它会报错："),s("code",[n._v("Uncaught ReferenceError: xxx is not defined")]),n._v("，这就属于 "),s("code",[n._v("JS运行异常")])]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("noEmit();   // 没有定义，直接调用\n// 会报错：Uncaught ReferenceError: noEmit is not defined\n复制代码\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br")])]),s("p",[n._v("那么，既然发生了错误，我们就需要去捕获它；"),s("strong",[n._v("而捕获JS运行异常有两种方法：")])]),n._v(" "),s("h5",{attrs:{id:"方法一"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#方法一"}},[n._v("#")]),n._v(" 方法一")]),n._v(" "),s("p",[n._v("我们可以使用 "),s("code",[n._v("window.onerror")]),n._v(" 来捕获全局的 "),s("code",[n._v("JS运行异常")]),n._v(","),s("code",[n._v("window.onerror")]),n._v(" 是一个全局变量，默认值为null。"),s("strong",[n._v("当有js运行时错误触发时，window会触发error事件")]),n._v("，并执行 "),s("code",[n._v("window.onerror()")]),n._v(",借助这个特性，我们对 "),s("code",[n._v("window.onerror")]),n._v(" 进行重写就可以捕获到代码中的异常；")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("window.onerror = (msg, url, row, col, error) => {\n  const exception = {\n    // 上报错误归类\n    mechanism: {\n      type: 'js'\n    },\n    // 错误信息\n    value: msg,\n    // 错误类型\n    type: error.name || 'UnKnowun',\n    // 解析后的错误堆栈\n    stackTrace: {\n      frames: parseStackFrames(error),\n    },\n    meta: {\n      url, // 文件地址\n      row, // 行号\n      col, // 列号\n    }\n  };\n  // 获取了报错详情，就可以走上报方法上报错误信息\n  console.log('JS运行error', exception);\n  return true; // 返回 true,阻止了默认事件执行,也就是原本将要在控制台打印的错误信息\n};\n复制代码\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br")])]),s("h5",{attrs:{id:"方法二"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#方法二"}},[n._v("#")]),n._v(" 方法二")]),n._v(" "),s("p",[n._v("我们还可以使用 "),s("code",[n._v("window.addEventListener('error')")]),n._v(" 来捕获 "),s("code",[n._v("JS运行异常")]),n._v("；它会比 "),s("code",[n._v("window.onerror")]),n._v(" "),s("strong",[n._v("先触发")]),n._v("；")]),n._v(" "),s("p",[s("strong",[n._v("我们简单封装一下：")])]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("// 初始化 JS异常 的数据获取和上报\ninitJsError = (): void => {\n  const handler = (event: ErrorEvent) => {\n    // 阻止向上抛出控制台报错\n    event.preventDefault();\n    // 如果不是 JS异常 就结束\n    if (getErrorKey(event) !== mechanismType.JS) return;\n    const exception = {\n      // 上报错误归类\n      mechanism: {\n        type: mechanismType.JS,\n      },\n      // 错误信息\n      value: event.message,\n      // 错误类型\n      type: (event.error && event.error.name) || 'UnKnowun',\n      // 解析后的错误堆栈\n      stackTrace: {\n        frames: parseStackFrames(event.error),\n      },\n      // 用户行为追踪 breadcrumbs 在 errorSendHandler 中统一封装\n      // 页面基本信息 pageInformation 也在 errorSendHandler 中统一封装\n      // 错误的标识码\n      errorUid: getErrorUid(`${mechanismType.JS}-${event.message}-${event.filename}`),\n      // 附带信息\n      meta: {\n        // file 错误所处的文件地址\n        file: event.filename,\n        // col 错误列号\n        col: event.colno,\n        // row 错误行号\n        row: event.lineno,\n      },\n    } as ExceptionMetrics;\n    // 一般错误异常立刻上报，不用缓存在本地\n    this.errorSendHandler(exception);\n  };\n  window.addEventListener('error', (event) => handler(event), true);\n};\n复制代码\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br"),s("span",{staticClass:"line-number"},[n._v("27")]),s("br"),s("span",{staticClass:"line-number"},[n._v("28")]),s("br"),s("span",{staticClass:"line-number"},[n._v("29")]),s("br"),s("span",{staticClass:"line-number"},[n._v("30")]),s("br"),s("span",{staticClass:"line-number"},[n._v("31")]),s("br"),s("span",{staticClass:"line-number"},[n._v("32")]),s("br"),s("span",{staticClass:"line-number"},[n._v("33")]),s("br"),s("span",{staticClass:"line-number"},[n._v("34")]),s("br"),s("span",{staticClass:"line-number"},[n._v("35")]),s("br"),s("span",{staticClass:"line-number"},[n._v("36")]),s("br"),s("span",{staticClass:"line-number"},[n._v("37")]),s("br"),s("span",{staticClass:"line-number"},[n._v("38")]),s("br"),s("span",{staticClass:"line-number"},[n._v("39")]),s("br"),s("span",{staticClass:"line-number"},[n._v("40")]),s("br")])]),s("h5",{attrs:{id:"两者的区别和选用"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#两者的区别和选用"}},[n._v("#")]),n._v(" 两者的区别和选用")]),n._v(" "),s("p",[n._v("阅读了上文，我们了解到想要监控 "),s("code",[n._v("JS运行异常")]),n._v(" ，我们有两种方法可以选用，那么我们"),s("strong",[n._v("应该选用哪一种")]),n._v("呢？或者说它们两者方法之间有什么区别呢？")]),n._v(" "),s("ul",[s("li",[n._v("它们两者均可以捕获到 "),s("code",[n._v("JS运行异常")]),n._v("，但是 方法二除了可以监听 "),s("code",[n._v("JS运行异常")]),n._v(" 之外，还可以同时捕获到 "),s("code",[n._v("静态资源加载异常")])]),n._v(" "),s("li",[s("code",[n._v("onerror")]),n._v(" 可以接受多个参数。而 "),s("code",[n._v("addEventListener('error')")]),n._v(" 只有一个保存所有错误信息的参数")])]),n._v(" "),s("p",[s("strong",[n._v("我这边个人更加建议使用第二种 "),s("code",[n._v("addEventListener('error')")]),n._v(" 的方式")]),n._v("；原因很简单："),s("code",[n._v("不像方法一可以被 window.onerror 重新覆盖")]),n._v("；"),s("code",[n._v("而且可以同时处理静态资源错误")])]),n._v(" "),s("h4",{attrs:{id:"错误类型"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#错误类型"}},[n._v("#")]),n._v(" 错误类型")]),n._v(" "),s("p",[n._v("细心的同学应该看见了，上文的捕获中，有一个参数叫做 "),s("code",[n._v("错误类型")]),n._v("，"),s("strong",[n._v("我们可以通过这个来快速判断错误是基于什么导致的")]),n._v("，那么 JS运行时的错误类型常见的有哪些呢？")]),n._v(" "),s("table",[s("thead",[s("tr",[s("th",[n._v("类型")]),n._v(" "),s("th",[n._v("含义")]),n._v(" "),s("th",[n._v("说明")])])]),n._v(" "),s("tbody",[s("tr",[s("td",[n._v("SyntaxError")]),n._v(" "),s("td",[n._v("语法错误")]),n._v(" "),s("td",[n._v("语法错误")])]),n._v(" "),s("tr",[s("td",[n._v("ReferenceError")]),n._v(" "),s("td",[n._v("引用错误")]),n._v(" "),s("td",[n._v("常见于引用了一个不存在的变量： "),s("code",[n._v("let a = undefinedVariable;")])])]),n._v(" "),s("tr",[s("td",[n._v("RangeError")]),n._v(" "),s("td",[n._v("有效范围错误")]),n._v(" "),s("td",[n._v("数值变量或参数超出了其有效范围。 常见于 1.创建一个负长度数组 2.Number对象的方法参数超出范围："),s("code",[n._v("let b = new Array(-1)")])])]),n._v(" "),s("tr",[s("td",[n._v("TypeError")]),n._v(" "),s("td",[n._v("类型错误")]),n._v(" "),s("td",[n._v("常见于变量或参数不属于有效类型 "),s("code",[n._v("let foo = 3;foo();")])])]),n._v(" "),s("tr",[s("td",[n._v("URIError")]),n._v(" "),s("td",[n._v("URL处理函数错误")]),n._v(" "),s("td",[n._v("使用全局URL处理函数错误，比如 "),s("code",[n._v("decodeURIComponent('%');")])])])])]),n._v(" "),s("ul",[s("li",[s("strong",[n._v("这里有一个点需要特别注意")]),n._v("，我们主观感觉上的 "),s("code",[n._v("SyntaxError 语法错误")]),n._v("，除了用 "),s("code",[n._v("eval()")]),n._v(" 执行的脚本以外，一般是不可以被捕获到的，比如我们编写一个"),s("code",[n._v("正常的语法错误")]),n._v("：")])]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("const d d = 1;\n// 控制台报错 :Uncaught SyntaxError: Missing initializer in const declaration\n// 但是上述的捕获方法无法正常捕获错误；\n复制代码\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br")])]),s("ul",[s("li",[n._v("这明显上是一个"),s("code",[n._v("语法上的错误")]),n._v("，但是我们上述的 "),s("code",[n._v("两个错误捕获方法")]),n._v("，"),s("strong",[n._v("都没办法捕获到错误")]),n._v("；")]),n._v(" "),s("li",[n._v("只有在代码中通过 "),s("code",[n._v("eval()")]),n._v(" 执行的代码脚本才可以正常捕获到错误信息；")])]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("eval('ddd fff');\n// 控制台报错 VM149:1 Uncaught SyntaxError: Unexpected identifier\n// 上文的错误捕获方法可以正常捕获到错误；\n复制代码\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br")])]),s("ul",[s("li",[s("strong",[n._v("那么，WHY")]),n._v("？")])]),n._v(" "),s("p",[n._v("其实原因很简单， "),s("code",[n._v("const d d = 1")]),n._v("; 这种语法错误，在"),s("code",[n._v("编译解析阶段")]),n._v("就已经报错了，而拥有语法错误的脚本不会放入"),s("code",[n._v("任务队列")]),n._v("进行执行，"),s("strong",[n._v("自然也就不会有错误冒泡到我们的捕获代码")]),n._v("；而我们使用 "),s("code",[n._v("eval()")]),n._v("；在编译解析阶段一切正常，直到执行的时候才进行报错，自然我们就可以捕获到这段错误；")]),n._v(" "),s("blockquote",[s("p",[s("strong",[n._v("当然，现在代码检查这么好用，早在编写代码时这种语法错误就被避免掉了，一般我们碰不上语法错误的")]),n._v("~")])]),n._v(" "),s("h4",{attrs:{id:"静态资源加载异常"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#静态资源加载异常"}},[n._v("#")]),n._v(" 静态资源加载异常")]),n._v(" "),s("p",[n._v("有的时候，我们界面上的 "),s("code",[n._v("img图片")]),n._v("、"),s("code",[n._v("CDN资源")]),n._v(" "),s("strong",[n._v("突然失效了、打不开了")]),n._v("，就比如以下面这个为例子，我们往html中放进一个img，把它的路径设为请求不到的地址：")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v('<img src="http://localhost:8888/nottrue.jpg">\n// 会报错 GET http://localhost:8888/nottrue.jpg net::ERR_CONNECTION_REFUSED\n复制代码\n')])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br")])]),s("p",[n._v("那我们怎么去捕获到这种请求不到资源的、或者说静态资源失效的报错呢？很简单，只需要祭出 "),s("code",[n._v("window.addEventListener('error')")]),n._v(" 就可以了")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("// 静态资源错误的 ErrorTarget\nexport interface ResourceErrorTarget {\n  src?: string;\n  tagName?: string;\n  outerHTML?: string;\n}\n\n// 初始化 静态资源异常 的数据获取和上报\ninitResourceError = (): void => {\n  const handler = (event: Event) => {\n    event.preventDefault(); // 阻止向上抛出控制台报错\n    // 如果不是跨域脚本异常,就结束\n    if (getErrorKey(event) !== mechanismType.RS) return;\n    const target = event.target as ResourceErrorTarget;\n    const exception = {\n      // 上报错误归类\n      mechanism: {\n        type: mechanismType.RS,\n      },\n      // 错误信息\n      value: '',\n      // 错误类型\n      type: 'ResourceError',\n      // 用户行为追踪 breadcrumbs 在 errorSendHandler 中统一封装\n      // 页面基本信息 pageInformation 也在 errorSendHandler 中统一封装\n      // 错误的标识码\n      errorUid: getErrorUid(`${mechanismType.RS}-${target.src}-${target.tagName}`),\n      // 附带信息\n      meta: {\n        url: target.src,\n        html: target.outerHTML,\n        type: target.tagName,\n      },\n    } as ExceptionMetrics;\n    // 一般错误异常立刻上报，不用缓存在本地\n    this.errorSendHandler(exception);\n  };\n  window.addEventListener('error', (event) => handler(event), true);\n};\n复制代码\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br"),s("span",{staticClass:"line-number"},[n._v("27")]),s("br"),s("span",{staticClass:"line-number"},[n._v("28")]),s("br"),s("span",{staticClass:"line-number"},[n._v("29")]),s("br"),s("span",{staticClass:"line-number"},[n._v("30")]),s("br"),s("span",{staticClass:"line-number"},[n._v("31")]),s("br"),s("span",{staticClass:"line-number"},[n._v("32")]),s("br"),s("span",{staticClass:"line-number"},[n._v("33")]),s("br"),s("span",{staticClass:"line-number"},[n._v("34")]),s("br"),s("span",{staticClass:"line-number"},[n._v("35")]),s("br"),s("span",{staticClass:"line-number"},[n._v("36")]),s("br"),s("span",{staticClass:"line-number"},[n._v("37")]),s("br"),s("span",{staticClass:"line-number"},[n._v("38")]),s("br"),s("span",{staticClass:"line-number"},[n._v("39")]),s("br"),s("span",{staticClass:"line-number"},[n._v("40")]),s("br")])]),s("blockquote",[s("p",[n._v("使用 "),s("code",[n._v("addEventListener")]),n._v(" 捕获资源错误时，一定要将 "),s("strong",[n._v("第三个选项设为 true")]),n._v("，因为资源错误没有冒泡，所以只能在捕获阶段捕获。同理，由于 window.onerror 是通过在冒泡阶段捕获错误，所以无法捕获资源错误。")])]),n._v(" "),s("h4",{attrs:{id:"promise异常"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#promise异常"}},[n._v("#")]),n._v(" Promise异常")]),n._v(" "),s("p",[n._v("什么叫 "),s("code",[n._v("Promise异常")]),n._v(" 呢？其实就是我们使用 "),s("code",[n._v("Promise")]),n._v(" 的过程中，当 "),s("code",[n._v("Promise")]),n._v(" 被 "),s("code",[n._v("reject")]),n._v(" 且没有被 "),s("code",[n._v("catch")]),n._v(" 处理的时候，就会抛出 "),s("code",[n._v("Promise异常")]),n._v("；同样的，如果我们在使用 "),s("code",[n._v("Promise")]),n._v(" 的过程中，报了JS的错误，同样也被以 "),s("code",[n._v("Promise异常")]),n._v(" 的形式抛出：")]),n._v(" "),s("p",[s("strong",[n._v("下面我举两个会产生 "),s("code",[n._v("Promise异常")]),n._v(" 的例子")])]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("Promise.resolve().then(() => console.log(c));\n// Uncaught (in promise) ReferenceError: c is not defined\nPromise.reject('reject了但是没有处理!')\n// Uncaught (in promise) reject了但是没有处理!\n复制代码\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br")])]),s("p",[n._v("而当抛出 "),s("code",[n._v("Promise异常")]),n._v(" 时，会触发 "),s("code",[n._v("unhandledrejection")]),n._v(" 事件，所以我们只需要去监听它就可以进行 "),s("code",[n._v("Promise 异常")]),n._v(" 的捕获了，不过值得注意的一点是："),s("strong",[n._v("相比与上面所述的直接获取报错的行号、列号等信息")]),n._v("，"),s("code",[n._v("Promise异常")]),n._v(" 我们只能捕获到一个 "),s("code",[n._v("报错原因")]),n._v(" 而已；")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("// 初始化 Promise异常 的数据获取和上报\ninitPromiseError = (): void => {\n  const handler = (event: PromiseRejectionEvent) => {\n    event.preventDefault(); // 阻止向上抛出控制台报错\n    const value = event.reason.message || event.reason;\n    const type = event.reason.name || 'UnKnowun';\n    const exception = {\n      // 上报错误归类\n      mechanism: {\n        type: mechanismType.UJ,\n      },\n      // 错误信息\n      value,\n      // 错误类型\n      type,\n      // 解析后的错误堆栈\n      stackTrace: {\n        frames: parseStackFrames(event.reason),\n      },\n      // 用户行为追踪 breadcrumbs 在 errorSendHandler 中统一封装\n      // 页面基本信息 pageInformation 也在 errorSendHandler 中统一封装\n      // 错误的标识码\n      errorUid: getErrorUid(`${mechanismType.UJ}-${value}-${type}`),\n      // 附带信息\n      meta: {},\n    } as ExceptionMetrics;\n    // 一般错误异常立刻上报，不用缓存在本地\n    this.errorSendHandler(exception);\n  };\n\n  window.addEventListener('unhandledrejection', (event) => handler(event), true);\n};\n复制代码\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br"),s("span",{staticClass:"line-number"},[n._v("27")]),s("br"),s("span",{staticClass:"line-number"},[n._v("28")]),s("br"),s("span",{staticClass:"line-number"},[n._v("29")]),s("br"),s("span",{staticClass:"line-number"},[n._v("30")]),s("br"),s("span",{staticClass:"line-number"},[n._v("31")]),s("br"),s("span",{staticClass:"line-number"},[n._v("32")]),s("br"),s("span",{staticClass:"line-number"},[n._v("33")]),s("br")])]),s("h4",{attrs:{id:"http请求异常"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#http请求异常"}},[n._v("#")]),n._v(" HTTP请求异常")]),n._v(" "),s("p",[s("strong",[n._v("HTTP请求的捕获，我在前文中已经写过代码，可以回翻")]),n._v(": "),s("a",{attrs:{href:"https://juejin.cn/post/7098656658649251877#heading-12",title:"https://juejin.cn/post/7098656658649251877#heading-12",target:"_blank",rel:"noopener noreferrer"}},[n._v("一文摸清前端监控实践要点（二）行为监控 HTTP 请求捕获"),s("OutboundLink")],1)]),n._v(" "),s("p",[n._v("所谓 "),s("code",[n._v("Http请求异常")]),n._v(" "),s("strong",[n._v("也就是异步请求 HTTP 接口时的异常罢了")]),n._v("，比如我调用了一个登录接口，但是我的传参不对，登录接口给我返回了 "),s("code",[n._v("500 错误码")]),n._v("，其实这个时候就已经产生了异常了；")]),n._v(" "),s("h5",{attrs:{id:"是否属于-promise异常"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#是否属于-promise异常"}},[n._v("#")]),n._v(" 是否属于 Promise异常")]),n._v(" "),s("p",[s("code",[n._v("看到这里，其实有的同学可能会疑惑")]),n._v("，我们现在的调用 HTTP 接口，一般也就是通过 "),s("code",[n._v("async/await")]),n._v(" 这种基于Promise的解决异步的最终方案；那么，"),s("strong",[n._v("假如说请求了一个接口地址报了500")]),n._v("，因为是基于 "),s("code",[n._v("Promise")]),n._v(" 调用的接口，我们"),s("strong",[n._v("能够")]),n._v("在上文的 "),s("code",[n._v("Promise异常")]),n._v(" 捕获中，获取到一个错误信息（如下图）；")]),n._v(" "),s("p",[n._v("但是有一个问题别忘记了，"),s("strong",[s("code",[n._v("Promise异常捕获没办法获取报错的行列")])]),n._v("，我们"),s("strong",[n._v("只知道")]),n._v(" Promise 报错了，报错的信息是 "),s("code",[n._v("接口请求500")]),n._v("；但是我们"),s("strong",[n._v("根本不知道是哪个接口报错了")]),n._v("；")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("复制代码\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br")])]),s("p",[s("img",{attrs:{src:"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/669f963fd18f4f10970a1f68c6d24557~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?",alt:"1e3b1763cf19402fbd0988d356fcd590.png"}})]),n._v(" "),s("p",[n._v("所以说，我们对于 "),s("code",[n._v("Http请求异常")]),n._v(" 的捕获需求就是："),s("code",[n._v("全局统一监控")]),n._v("、"),s("code",[n._v("报错的具体接口")]),n._v("、"),s("code",[n._v("请求状态码")]),n._v("、"),s("code",[n._v("请求耗时")]),n._v("以及"),s("code",[n._v("请求参数")]),n._v("等等；")]),n._v(" "),s("p",[n._v("而为了实现上述的监控需求，我们需要了解到：现在异步请求的底层原理都是调用的 "),s("code",[n._v("XMLHttpRequest")]),n._v(" 或者 "),s("code",[n._v("Fetch")]),n._v("，我们只需要对这两个方法都进行 "),s("code",[n._v("劫持")]),n._v(" ，就可以往接口请求的过程中加入我们所需要的一些参数捕获；")]),n._v(" "),s("h5",{attrs:{id:"代码实现"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#代码实现"}},[n._v("#")]),n._v(" 代码实现")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("// 初始化 HTTP请求异常 的数据获取和上报\ninitHttpError = (): void => {\n  const loadHandler = (metrics: httpMetrics) => {\n    // 如果 status 状态码小于 400,说明没有 HTTP 请求错误\n    if (metrics.status < 400) return;\n    const value = metrics.response;\n    const exception = {\n      // 上报错误归类\n      mechanism: {\n        type: mechanismType.HP,\n      },\n      // 错误信息\n      value,\n      // 错误类型\n      type: 'HttpError',\n      // 错误的标识码\n      errorUid: getErrorUid(`${mechanismType.HP}-${value}-${metrics.statusText}`),\n      // 附带信息\n      meta: {\n        metrics,\n      },\n    } as ExceptionMetrics;\n    // 一般错误异常立刻上报，不用缓存在本地\n    this.errorSendHandler(exception);\n  };\n  proxyXmlHttp(null, loadHandler);\n  proxyFetch(null, loadHandler);\n};\n复制代码\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br"),s("span",{staticClass:"line-number"},[n._v("27")]),s("br"),s("span",{staticClass:"line-number"},[n._v("28")]),s("br"),s("span",{staticClass:"line-number"},[n._v("29")]),s("br")])]),s("h4",{attrs:{id:"跨域脚本错误"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#跨域脚本错误"}},[n._v("#")]),n._v(" 跨域脚本错误")]),n._v(" "),s("h5",{attrs:{id:"介绍"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#介绍"}},[n._v("#")]),n._v(" 介绍")]),n._v(" "),s("p",[n._v("还有一种错误，平常我们较难遇到，那就是 "),s("code",[n._v("跨域脚本错误")]),n._v(" ，什么叫 "),s("code",[n._v("跨域脚本错误")]),n._v(" 呢？比如说我们新建一个"),s("code",[n._v("texterror.js")]),n._v(" 文件到 "),s("code",[n._v("项目B")]),n._v(" 的 public 目录下以供外部访问;")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("// 新建的 texterror.js 文件\nconst a = new Array(-1);\n复制代码\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br")])]),s("p",[n._v("可以看到，我们在 "),s("code",[n._v("texterror.js")]),n._v(" 文件中"),s("strong",[n._v("写了一行会报错的代码")]),n._v("，认真看过上文的同学应该知道，它会被捕获在 "),s("code",[n._v("JS运行异常")]),n._v("中，且错误类型为 "),s("code",[n._v("RangeError")]),n._v(" ；而我们从 "),s("code",[n._v("项目A")]),n._v(" 中引入它；")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v('// 项目B的地址，和项目A端口不同；\n<script async src="http://xxxxxx:8081/texterror.js"> <\/script>\n复制代码\n')])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br")])]),s("p",[s("strong",[n._v("加载后运行，我们自然能在控制台发现报错：而我们上文的代码捕获也有错误捕获到：")])]),n._v(" "),s("p",[s("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a2cf0152a75746de8013d120f07e9ceb~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?",alt:"99e47b449f444af3be512799d4933ddf.png"}})]),n._v(" "),s("p",[s("img",{attrs:{src:"https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/000f4b4a285444c9984c5cb62435dfd4~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?",alt:"image.png"}})]),n._v(" "),s("p",[n._v("但是我们发现，这里的 "),s("code",[n._v("msg")]),n._v(" 信息是 "),s("code",[n._v("Script error")]),n._v("，也没有获取到"),s("code",[n._v("行号")]),n._v("、"),s("code",[n._v("列号")]),n._v("、"),s("code",[n._v("文件名")]),n._v("等的信息，"),s("strong",[n._v("这是怎么回事呢？")])]),n._v(" "),s("p",[n._v("其实这是浏览器的一个"),s("code",[n._v("安全机制")]),n._v("："),s("strong",[n._v("当跨域加载的脚本中发生语法错误时，浏览器出于安全考虑，不会报告错误的细节，而只报告简单的 "),s("code",[n._v("Script error")]),n._v("。浏览器只允许同域下的脚本捕获具体错误信息，而其他脚本只知道发生了一个错误，但无法获知错误的具体内容（控制台仍然可以看到，JS脚本无法捕获）")]),n._v(" ，我们上文通过项目A去加载项目B的文件，自然产生了跨域；")]),n._v(" "),s("h5",{attrs:{id:"处理"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#处理"}},[n._v("#")]),n._v(" 处理")]),n._v(" "),s("p",[s("strong",[n._v("其实对于三方脚本的错误，我们是否捕获都可以")]),n._v("，不过我们需要一点处理，"),s("strong",[n._v("如果不需要捕获的话，就不进行上报")]),n._v("，如果需要捕获的话，只上报类型；我们甚至可以只关心自己的远端JS问题，去根据公司域名进行过滤 filename。")]),n._v(" "),s("p",[n._v("我们对上文的 "),s("code",[n._v("window.addEventListener('error')")]),n._v(" "),s("strong",[n._v("再加上对跨域资源的判断")]),n._v("，以和正常的代码中错误区分开；")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("// 初始化 跨域异常 的数据获取和上报\ninitCorsError = (): void => {\n  const handler = (event: ErrorEvent) => {\n    // 阻止向上抛出控制台报错\n    event.preventDefault();\n    // 如果不是跨域脚本异常,就结束\n    if (getErrorKey(event) !== mechanismType.CS) return;\n    const exception = {\n      // 上报错误归类\n      mechanism: {\n        type: mechanismType.CS,\n      },\n      // 错误信息\n      value: event.message,\n      // 错误类型\n      type: 'CorsError',\n      // 错误的标识码\n      errorUid: getErrorUid(`${mechanismType.JS}-${event.message}`),\n      // 附带信息\n      meta: {},\n    } as ExceptionMetrics;\n    // 自行上报异常，也可以跨域脚本的异常都不上报;\n    this.errorSendHandler(exception);\n  };\n  window.addEventListener('error', (event) => handler(event), true);\n};\n复制代码\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br"),s("span",{staticClass:"line-number"},[n._v("27")]),s("br")])]),s("h5",{attrs:{id:"补充"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#补充"}},[n._v("#")]),n._v(" 补充")]),n._v(" "),s("p",[n._v("看到了这里，可能还有的同学想了解："),s("strong",[n._v("那么这种跨域的脚本错误我们就没有办法进行获取错误详情吗")]),n._v("？答案还是有的：")]),n._v(" "),s("p",[n._v("我们只需要 "),s("strong",[s("code",[n._v("开启跨域资源共享CORS（Cross Origin Resource Sharing）")])]),n._v(" ，就可以捕获错误了~我们需要分两步来进行实现：")]),n._v(" "),s("ol",[s("li",[s("strong",[n._v("添加"),s("code",[n._v('crossorigin="anonymous"')]),n._v("属性。")])])]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v('<script src="http://xxxxxxxx/texterror.js" crossorigin="anonymous"><\/script>\n复制代码\n')])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br")])]),s("ol",{attrs:{start:"2"}},[s("li",[s("strong",[n._v("添加"),s("code",[n._v("跨域HTTP响应头")]),n._v("。")])])]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("Access-Control-Allow-Origin: *\n复制代码\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br")])]),s("p",[n._v("这两步完成后，允许了跨域，我们就可以在错误捕获脚本中获取到具体的错误信息拉！")]),n._v(" "),s("h4",{attrs:{id:"vue2、vue3-错误捕获"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#vue2、vue3-错误捕获"}},[n._v("#")]),n._v(" Vue2、Vue3 错误捕获")]),n._v(" "),s("ul",[s("li",[s("code",[n._v("Vue2")]),n._v(" 如果在组件渲染时出现运行错误，错误将会被传递至全局 "),s("a",{attrs:{href:"https://link.juejin.cn?target=https%3A%2F%2Fcn.vuejs.org%2Fv2%2Fguide%2Fdeployment.html%23%25E8%25B7%259F%25E8%25B8%25AA%25E8%25BF%2590%25E8%25A1%258C%25E6%2597%25B6%25E9%2594%2599%25E8%25AF%25AF",title:"https://cn.vuejs.org/v2/guide/deployment.html#%E8%B7%9F%E8%B8%AA%E8%BF%90%E8%A1%8C%E6%97%B6%E9%94%99%E8%AF%AF",target:"_blank",rel:"noopener noreferrer"}},[n._v("Vue.config.errorHandler"),s("OutboundLink")],1),n._v(" 配置函数；")]),n._v(" "),s("li",[s("code",[n._v("Vue3")]),n._v(" 同 "),s("code",[n._v("Vue2")]),n._v("，如果在组件渲染时出现运行错误，错误将会被传递至全局的 "),s("a",{attrs:{href:"https://link.juejin.cn?target=https%3A%2F%2Fv3.cn.vuejs.org%2Fguide%2Ftooling%2Fdeployment.html%23%25E8%25B7%259F%25E8%25B8%25AA%25E8%25BF%2590%25E8%25A1%258C%25E6%2597%25B6%25E9%2594%2599%25E8%25AF%25AF",title:"https://v3.cn.vuejs.org/guide/tooling/deployment.html#%E8%B7%9F%E8%B8%AA%E8%BF%90%E8%A1%8C%E6%97%B6%E9%94%99%E8%AF%AF",target:"_blank",rel:"noopener noreferrer"}},[n._v("app.config.errorHandler"),s("OutboundLink")],1),n._v(" 配置函数；")])]),n._v(" "),s("p",[s("strong",[n._v("我们可以利用这两个钩子函数来进行错误捕获")]),n._v("，由于是依赖于 "),s("code",[n._v("Vue配置函数")]),n._v(" 的错误捕获，所以我们在"),s("code",[n._v("初始化")]),n._v("时，需要用户将 "),s("code",[n._v("Vue实例")]),n._v(" 传进来；")]),n._v(" "),s("h5",{attrs:{id:"获取报错组件名"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#获取报错组件名"}},[n._v("#")]),n._v(" 获取报错组件名")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("export interface Vue {\n  config: {\n    errorHandler?: any;\n    warnHandler?: any;\n  };\n}\n\nexport interface ViewModel {\n  _isVue?: boolean;\n  __isVue?: boolean;\n  $root: ViewModel;\n  $parent?: ViewModel;\n  $props: { [key: string]: any };\n  $options: {\n    name?: string;\n    propsData?: { [key: string]: any };\n    _componentTag?: string;\n    __file?: string;\n  };\n}\n\n// 获取报错组件名\nconst classifyRE = /(?:^|[-_])(\\w)/g;\nconst classify = (str: string) => str.replace(classifyRE, (c) => c.toUpperCase()).replace(/[-_]/g, '');\nconst ROOT_COMPONENT_NAME = '<Root>';\nconst ANONYMOUS_COMPONENT_NAME = '<Anonymous>';\nexport const formatComponentName = (vm: ViewModel, includeFile: Boolean) => {\n  if (!vm) {\n    return ANONYMOUS_COMPONENT_NAME;\n  }\n  if (vm.$root === vm) {\n    return ROOT_COMPONENT_NAME;\n  }\n  const options = vm.$options;\n  let name = options.name || options._componentTag;\n  const file = options.__file;\n  if (!name && file) {\n    const match = file.match(/([^/\\]+).vue$/);\n    if (match) {\n      name = match[1];\n    }\n  }\n  return (\n    (name ? `<${classify(name)}>` : ANONYMOUS_COMPONENT_NAME) + (file && includeFile !== false ? ` at ${file}` : '')\n  );\n};\n复制代码\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br"),s("span",{staticClass:"line-number"},[n._v("27")]),s("br"),s("span",{staticClass:"line-number"},[n._v("28")]),s("br"),s("span",{staticClass:"line-number"},[n._v("29")]),s("br"),s("span",{staticClass:"line-number"},[n._v("30")]),s("br"),s("span",{staticClass:"line-number"},[n._v("31")]),s("br"),s("span",{staticClass:"line-number"},[n._v("32")]),s("br"),s("span",{staticClass:"line-number"},[n._v("33")]),s("br"),s("span",{staticClass:"line-number"},[n._v("34")]),s("br"),s("span",{staticClass:"line-number"},[n._v("35")]),s("br"),s("span",{staticClass:"line-number"},[n._v("36")]),s("br"),s("span",{staticClass:"line-number"},[n._v("37")]),s("br"),s("span",{staticClass:"line-number"},[n._v("38")]),s("br"),s("span",{staticClass:"line-number"},[n._v("39")]),s("br"),s("span",{staticClass:"line-number"},[n._v("40")]),s("br"),s("span",{staticClass:"line-number"},[n._v("41")]),s("br"),s("span",{staticClass:"line-number"},[n._v("42")]),s("br"),s("span",{staticClass:"line-number"},[n._v("43")]),s("br"),s("span",{staticClass:"line-number"},[n._v("44")]),s("br"),s("span",{staticClass:"line-number"},[n._v("45")]),s("br"),s("span",{staticClass:"line-number"},[n._v("46")]),s("br"),s("span",{staticClass:"line-number"},[n._v("47")]),s("br")])]),s("h5",{attrs:{id:"初始化封装"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#初始化封装"}},[n._v("#")]),n._v(" 初始化封装")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("// 只需要在外部把初始化好的 Vue 对象传入即可~\n// 初始化 Vue异常 的数据获取和上报\ninitVueError = (app: Vue): void => {\n  app.config.errorHandler = (err: Error, vm: ViewModel, info: string): void => {\n    const componentName = formatComponentName(vm, false);\n    const exception = {\n      // 上报错误归类\n      mechanism: {\n        type: mechanismType.VUE,\n      },\n      // 错误信息\n      value: err.message,\n      // 错误类型\n      type: err.name,\n      // 解析后的错误堆栈\n      stackTrace: {\n        frames: parseStackFrames(err),\n      },\n      // 错误的标识码\n      errorUid: getErrorUid(`${mechanismType.JS}-${err.message}-${componentName}-${info}`),\n      // 附带信息\n      meta: {\n        // 报错的Vue组件名\n        componentName,\n        // 报错的Vue阶段\n        hook: info,\n      },\n    } as ExceptionMetrics;\n    // 一般错误异常立刻上报，不用缓存在本地\n    this.errorSendHandler(exception);\n  };\n};\n复制代码\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br"),s("span",{staticClass:"line-number"},[n._v("27")]),s("br"),s("span",{staticClass:"line-number"},[n._v("28")]),s("br"),s("span",{staticClass:"line-number"},[n._v("29")]),s("br"),s("span",{staticClass:"line-number"},[n._v("30")]),s("br"),s("span",{staticClass:"line-number"},[n._v("31")]),s("br"),s("span",{staticClass:"line-number"},[n._v("32")]),s("br"),s("span",{staticClass:"line-number"},[n._v("33")]),s("br")])]),s("h4",{attrs:{id:"react-错误捕获"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#react-错误捕获"}},[n._v("#")]),n._v(" React 错误捕获")]),n._v(" "),s("p",[s("code",[n._v("React")]),n._v(" 一样也有官方提供的错误捕获，见文档："),s("a",{attrs:{href:"https://link.juejin.cn?target=https%3A%2F%2Fzh-hans.reactjs.org%2Fdocs%2Freact-component.html%23componentdidcatch",title:"https://zh-hans.reactjs.org/docs/react-component.html#componentdidcatch",target:"_blank",rel:"noopener noreferrer"}},[n._v("zh-hans.reactjs.org/docs/react-…"),s("OutboundLink")],1)]),n._v(" "),s("p",[n._v("和 "),s("code",[n._v("Vue")]),n._v(" 不同的是，我们需要"),s("strong",[n._v("自己定义一个高阶组件暴露给项目使用")]),n._v("，我这里就不具体详写了，感兴趣的同学可以自己进行补全：")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("import * as React from 'react';\nclass ErrorBoundary extends React.Component {\n  constructor(props) {\n    super(props);\n  }\n  // ...\n  componentDidCatch(error, info) {\n    // \"组件堆栈\" 例子:\n    //   in ComponentThatThrows (created by App)\n    //   in ErrorBoundary (created by App)\n    //   in div (created by App)\n    //   in App\n  }\n  // ...\n}\n复制代码\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br")])]),s("p",[n._v("项目使用方只需要这样既可：")]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v('import React from "react";\n\n<ErrorBoundary>\n  <Example />\n</ErrorBoundary>;\n复制代码\n')])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br")])]),s("h4",{attrs:{id:"source-map"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#source-map"}},[n._v("#")]),n._v(" Source Map")]),n._v(" "),s("p",[n._v("我们的项目想要部署上线，就需要将项目源码经过"),s("code",[n._v("混淆")]),n._v("、"),s("code",[n._v("压缩")]),n._v("、"),s("code",[n._v("babel编译转化")]),n._v("等等的操作之后，生成最终的"),s("code",[n._v("打包产物")]),n._v("，再进行线上部署；而这样"),s("code",[n._v("混淆后的代码")]),n._v("，我们基本上无法阅读，"),s("strong",[n._v("即使在上文的错误监控里，我们获取了报错代码的行号、列号等关键信息，我们也无法找到具体的"),s("code",[n._v("源码位置所在")])]),n._v("；这个时候就需要请出我们的 "),s("code",[n._v("Sourcemap")]),n._v(" 了")]),n._v(" "),s("p",[s("strong",[s("code",[n._v("Sourcemap")]),n._v(" 本质上是一个信息文件")]),n._v("，里面储存着代码转换前后的对应位置信息。它记录了转换压缩后的代码所对应的转换前的源代码位置，是源代码和生产代码的映射。")]),n._v(" "),s("p",[n._v("我们通过种种打包工具打包后，如果开启了 "),s("code",[n._v("Sourcemap")]),n._v(" 功能，就会在打包产物里发现后缀为 "),s("code",[n._v(".map")]),n._v(" 的文件，"),s("strong",[n._v("通过对它的解析，我们就可以得到项目的源代码；")])]),n._v(" "),s("ul",[s("li",[n._v("我这里举例一个通过 "),s("code",[n._v("nodejs")]),n._v(" 进行 "),s("code",[n._v("SourceMap")]),n._v(" 解析的例子代码：")])]),n._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[n._v("// 这里因为 npm 装了 babel，所以用的 import，正常 nodejs 下为 require\nimport sourceMap from 'source-map';    //source-map库\nimport fs from 'fs'                    //fs为nodejs读取文件的库\nimport rp from 'request-promise'\n\n/**\n * @description:  用来解析 sourcemap 的函数方法\n * @param {*} sourceMapFile 传入的 .map 源文件\n * @param {*} line  报错行数\n * @param {*} column  报错列数\n * @param {*} offset  需要截取几行的代码\n * @return {*}\n */\nexport const sourceMapAnalysis = async (sourceMapFile, line, column, offset) => {\n// 通过 sourceMap 库转换为sourceMapConsumer对象\n  const consumer = await new sourceMap.SourceMapConsumer(sourceMapFile);\n  // 传入要查找的行列数，查找到压缩前的源文件及行列数\n  const sm = consumer.originalPositionFor({\n    line, // 压缩后的行数\n    column, // 压缩后的列数\n  });\n  // 压缩前的所有源文件列表\n  const { sources } = consumer;\n  // 根据查到的source，到源文件列表中查找索引位置\n  const smIndex = sources.indexOf(sm.source);\n  // 到源码列表中查到源代码\n  const smContent = consumer.sourcesContent[smIndex];\n  // 将源代码串按\"行结束标记\"拆分为数组形式\n  const rawLines = smContent.split(/\\r?\\n/g);\n  let begin = sm.line - offset;\n  const end = sm.line + offset + 1;\n  begin = begin < 0 ? 0 : begin;\n  const context = rawLines.slice(begin, end);\n  // 可以根据自己的需要，在末尾处加上 \\n\n  // const context = rawLines.slice(begin, end).join('\\n');\n  // 销毁\n  consumer.destroy();\n  return {\n    // 报错的具体代码\n    context,\n    // 报错在文件的第几行\n    originLine: sm.line + 1, // line 是从 0 开始数，所以 +1\n    // source 报错的文件路径\n    source: sm.source,\n  }\n};\n\n// 请求线上的 .map 文件进行解析\nexport const loadMapFileByUrl = async (url)=>{\n  return await rp(url)\n}\nconst line = 9;\nconst column = 492621;\nconst rawSourceMap = JSON.parse(\n  // 这里加载在本地的 .map 文件\n  fs.readFileSync('./xxxxxxxxxxxxxxx.map','utf-8').toString()    // 路径自拟\n);\nconst inlineSourceMap = JSON.parse(await loadMapFileByUrl('http://xxxxxxxxxxxx.map')) // 路径自换\n\n// 从url获取 sourcemap 文件\n// const res = await sourceMapAnalysis(inlineSourceMap,line,column,2)\n// 从本地获取 sourcemap 文件\nconst res = await sourceMapAnalysis(rawSourceMap,line,column,2)\n\nconsole.log(res);\n复制代码\n")])]),n._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[n._v("1")]),s("br"),s("span",{staticClass:"line-number"},[n._v("2")]),s("br"),s("span",{staticClass:"line-number"},[n._v("3")]),s("br"),s("span",{staticClass:"line-number"},[n._v("4")]),s("br"),s("span",{staticClass:"line-number"},[n._v("5")]),s("br"),s("span",{staticClass:"line-number"},[n._v("6")]),s("br"),s("span",{staticClass:"line-number"},[n._v("7")]),s("br"),s("span",{staticClass:"line-number"},[n._v("8")]),s("br"),s("span",{staticClass:"line-number"},[n._v("9")]),s("br"),s("span",{staticClass:"line-number"},[n._v("10")]),s("br"),s("span",{staticClass:"line-number"},[n._v("11")]),s("br"),s("span",{staticClass:"line-number"},[n._v("12")]),s("br"),s("span",{staticClass:"line-number"},[n._v("13")]),s("br"),s("span",{staticClass:"line-number"},[n._v("14")]),s("br"),s("span",{staticClass:"line-number"},[n._v("15")]),s("br"),s("span",{staticClass:"line-number"},[n._v("16")]),s("br"),s("span",{staticClass:"line-number"},[n._v("17")]),s("br"),s("span",{staticClass:"line-number"},[n._v("18")]),s("br"),s("span",{staticClass:"line-number"},[n._v("19")]),s("br"),s("span",{staticClass:"line-number"},[n._v("20")]),s("br"),s("span",{staticClass:"line-number"},[n._v("21")]),s("br"),s("span",{staticClass:"line-number"},[n._v("22")]),s("br"),s("span",{staticClass:"line-number"},[n._v("23")]),s("br"),s("span",{staticClass:"line-number"},[n._v("24")]),s("br"),s("span",{staticClass:"line-number"},[n._v("25")]),s("br"),s("span",{staticClass:"line-number"},[n._v("26")]),s("br"),s("span",{staticClass:"line-number"},[n._v("27")]),s("br"),s("span",{staticClass:"line-number"},[n._v("28")]),s("br"),s("span",{staticClass:"line-number"},[n._v("29")]),s("br"),s("span",{staticClass:"line-number"},[n._v("30")]),s("br"),s("span",{staticClass:"line-number"},[n._v("31")]),s("br"),s("span",{staticClass:"line-number"},[n._v("32")]),s("br"),s("span",{staticClass:"line-number"},[n._v("33")]),s("br"),s("span",{staticClass:"line-number"},[n._v("34")]),s("br"),s("span",{staticClass:"line-number"},[n._v("35")]),s("br"),s("span",{staticClass:"line-number"},[n._v("36")]),s("br"),s("span",{staticClass:"line-number"},[n._v("37")]),s("br"),s("span",{staticClass:"line-number"},[n._v("38")]),s("br"),s("span",{staticClass:"line-number"},[n._v("39")]),s("br"),s("span",{staticClass:"line-number"},[n._v("40")]),s("br"),s("span",{staticClass:"line-number"},[n._v("41")]),s("br"),s("span",{staticClass:"line-number"},[n._v("42")]),s("br"),s("span",{staticClass:"line-number"},[n._v("43")]),s("br"),s("span",{staticClass:"line-number"},[n._v("44")]),s("br"),s("span",{staticClass:"line-number"},[n._v("45")]),s("br"),s("span",{staticClass:"line-number"},[n._v("46")]),s("br"),s("span",{staticClass:"line-number"},[n._v("47")]),s("br"),s("span",{staticClass:"line-number"},[n._v("48")]),s("br"),s("span",{staticClass:"line-number"},[n._v("49")]),s("br"),s("span",{staticClass:"line-number"},[n._v("50")]),s("br"),s("span",{staticClass:"line-number"},[n._v("51")]),s("br"),s("span",{staticClass:"line-number"},[n._v("52")]),s("br"),s("span",{staticClass:"line-number"},[n._v("53")]),s("br"),s("span",{staticClass:"line-number"},[n._v("54")]),s("br"),s("span",{staticClass:"line-number"},[n._v("55")]),s("br"),s("span",{staticClass:"line-number"},[n._v("56")]),s("br"),s("span",{staticClass:"line-number"},[n._v("57")]),s("br"),s("span",{staticClass:"line-number"},[n._v("58")]),s("br"),s("span",{staticClass:"line-number"},[n._v("59")]),s("br"),s("span",{staticClass:"line-number"},[n._v("60")]),s("br"),s("span",{staticClass:"line-number"},[n._v("61")]),s("br"),s("span",{staticClass:"line-number"},[n._v("62")]),s("br"),s("span",{staticClass:"line-number"},[n._v("63")]),s("br"),s("span",{staticClass:"line-number"},[n._v("64")]),s("br"),s("span",{staticClass:"line-number"},[n._v("65")]),s("br"),s("span",{staticClass:"line-number"},[n._v("66")]),s("br")])]),s("p",[s("strong",[s("code",[n._v("效果如下:")])])]),n._v(" "),s("p",[s("img",{attrs:{src:"https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/7b37ce5ba6ee45a68cd4580df18da884~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?",alt:"d35fa52dcdb1439ebb64a112223b0848.png"}})]),n._v(" "),s("blockquote",[s("p",[n._v("注意：使用 "),s("code",[n._v("Sourcemap")]),n._v(" 的同学注意在打包的时候，将 "),s("code",[n._v(".map")]),n._v(" 文件和"),s("code",[n._v("部署产物")]),n._v("分离，"),s("strong",[n._v("不能部署到线上地址哦！")]),n._v(" 如果你将 "),s("code",[n._v(".map")]),n._v(" 部署上去了，那么你项目的代码也就是直接明文跑在网页上，"),s("strong",[n._v("谁都可以查看未混淆的源码拉！")])])]),n._v(" "),s("h3",{attrs:{id:"参考阅读"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#参考阅读"}},[n._v("#")]),n._v(" 参考阅读")]),n._v(" "),s("p",[s("a",{attrs:{href:"https://link.juejin.cn?target=https%3A%2F%2Fzh-hans.reactjs.org%2Fdocs%2Freact-component.html%23componentdidcatch",title:"https://zh-hans.reactjs.org/docs/react-component.html#componentdidcatch",target:"_blank",rel:"noopener noreferrer"}},[n._v("React componentDidCatch"),s("OutboundLink")],1)]),n._v(" "),s("p",[s("a",{attrs:{href:"https://link.juejin.cn?target=https%3A%2F%2Fcn.vuejs.org%2Fv2%2Fguide%2Fdeployment.html%23%25E8%25B7%259F%25E8%25B8%25AA%25E8%25BF%2590%25E8%25A1%258C%25E6%2597%25B6%25E9%2594%2599%25E8%25AF%25AF",title:"https://cn.vuejs.org/v2/guide/deployment.html#%E8%B7%9F%E8%B8%AA%E8%BF%90%E8%A1%8C%E6%97%B6%E9%94%99%E8%AF%AF",target:"_blank",rel:"noopener noreferrer"}},[n._v("Vue errorHandler"),s("OutboundLink")],1)]),n._v(" "),s("p",[s("a",{attrs:{href:"https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fgetsentry%2Fsentry-javascript",title:"https://github.com/getsentry/sentry-javascript",target:"_blank",rel:"noopener noreferrer"}},[n._v("sentry-javascript 源码"),s("OutboundLink")],1)])])}),[],!1,null,null,null);s.default=r.exports}}]);