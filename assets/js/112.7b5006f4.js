(window.webpackJsonp=window.webpackJsonp||[]).push([[112],{308:function(s,e,n){"use strict";n.r(e);var a=n(14),r=Object(a.a)({},(function(){var s=this,e=s._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("p",[s._v("上一篇我们经历了一次"),e("strong",[s._v("头脑爆炸")]),s._v("，一口气看完了从webpack-cli到babel-loader的全流程。"),e("br"),s._v("\n这一篇可以放松一下了，"),e("br"),s._v("\n来看看hooks中到底包含了什么秘密。")]),s._v(" "),e("h3",{attrs:{id:"_1-hooks回顾"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-hooks回顾"}},[s._v("#")]),s._v(" 1. hooks回顾")]),s._v(" "),e("p",[s._v("我们知道在webpack Compiler.js中"),e("a",{attrs:{href:"https://github.com/webpack/webpack/blob/v4.20.2/lib/Compiler.js#L536",target:"_blank",rel:"noopener noreferrer"}},[s._v("第536行"),e("OutboundLink")],1),s._v("，"),e("br"),s._v(" "),e("code",[s._v("this.compile")]),s._v("中调用了"),e("code",[s._v("hooks.make")]),s._v("，")]),s._v(" "),e("p",[s._v("**")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("compile(callback) {\n    const params = this.newCompilationParams();\n    this.hooks.beforeCompile.callAsync(params, err => {\n        if (err) return callback(err);\n\n        this.hooks.compile.call(params);\n\n        const compilation = this.newCompilation(params);\n\n        this.hooks.make.callAsync(compilation, err => {\n            if (err) return callback(err);\n\n            compilation.finish();\n\n            compilation.seal(err => {\n                if (err) return callback(err);\n\n                this.hooks.afterCompile.callAsync(compilation, err => {\n                    if (err) return callback(err);\n\n                    return callback(null, compilation);\n                });\n            });\n        });\n    });\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br")])]),e("p",[s._v("结果 "),e("code",[s._v("this.hooks.make.callAsync(compilation, err => {")]),e("br"),s._v("\n居然会跳转到，"),e("a",{attrs:{href:"https://github.com/webpack/webpack/blob/v4.20.2/lib/SingleEntryPlugin.js",target:"_blank",rel:"noopener noreferrer"}},[s._v("SingleEntryPlugin.js"),e("OutboundLink")],1),s._v(" 文件中。")]),s._v(" "),e("p",[s._v("**")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('compiler.hooks.make.tapAsync(\n    "SingleEntryPlugin",\n    (compilation, callback) => {\n        const { entry, name, context } = this;\n\n        const dep = SingleEntryPlugin.createDependency(entry, name);\n        compilation.addEntry(context, dep, name, callback);\n    }\n);\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br")])]),e("p",[s._v("这其中发生了什么？"),e("br"),s._v("\n为了理解这一点，我们还得从webpack plugin说起。")]),s._v(" "),e("h3",{attrs:{id:"_2-webpack插件的编写方式"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-webpack插件的编写方式"}},[s._v("#")]),s._v(" 2. webpack插件的编写方式")]),s._v(" "),e("p",[s._v("我认为从"),e("strong",[s._v("用例")]),s._v("中学习代码库，会把事情变简单，"),e("br"),s._v("\n因为代码的设计目的，就是为它的"),e("strong",[s._v("使用场景")]),s._v("服务的。")]),s._v(" "),e("p",[s._v("所以，一开始我们不宜直接研究hooks是如何实现的，"),e("br"),s._v("\n而是看看hooks的设计者们，期望它被如何使用。")]),s._v(" "),e("p",[s._v("hooks最常见的使用场景，就是当我们在给webpack编写插件的时候，"),e("br"),s._v("\n插件中会实现"),e("code",[s._v("compiler")]),s._v("和"),e("code",[s._v("compilation")]),s._v("对象的多个hooks，"),e("br"),s._v("\n下面我们来创建一个webpack 插件。")]),s._v(" "),e("h4",{attrs:{id:"_2-1-test-plugin-js"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-test-plugin-js"}},[s._v("#")]),s._v(" 2.1 test-plugin.js")]),s._v(" "),e("p",[s._v("在我们的"),e("a",{attrs:{href:"https://www.jianshu.com/p/2fa6562210ef",target:"_blank",rel:"noopener noreferrer"}},[s._v("debug-webpack"),e("OutboundLink")],1),s._v("工程中，我们在根目录中新建一个test-plugin.js文件。")]),s._v(" "),e("p",[s._v("**")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("module.exports = class Plugin {\n    apply(compiler) {\n        compiler.hooks.make.tapAsync('TestPlugin', (compilation, callback) => {\n            compilation.hooks.buildModule.tap('TestPlugin', module => {\n                console.log('module.resource', module.resource);\n                console.log('module.loaders', module.loaders);\n                console.time('TestPlugin');\n            });\n\n            compilation.hooks.succeedModule.tap('TestPlugin', module => {\n                console.timeEnd('TestPlugin');\n            });\n\n            callback();\n        });\n    }\n};\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br")])]),e("p",[s._v("它导出了一个类，这个类必须实现"),e("code",[s._v("apply")]),s._v("方法。")]),s._v(" "),e("p",[s._v("其中，apply方法的形参是"),e("code",[s._v("compiler")]),s._v("，"),e("br"),s._v("\n就是webpack-cli中调用的"),e("code",[s._v("compiler.run")]),s._v("的那个"),e("code",[s._v("compiler")]),s._v("。"),e("br"),s._v("\n至于更细节的问题，我们以后可以再慢慢看。")]),s._v(" "),e("p",[e("strong",[s._v("（1）compiler.hooks.make.tapAsync")]),e("br"),s._v(" "),e("code",[s._v("compiler.hooks.make.tapAsync")]),s._v("实现了"),e("code",[s._v("compiler.hooks.make")]),s._v("，"),e("br"),s._v("\n如果我们增加了这个实现，"),e("br"),s._v(" "),e("a",{attrs:{href:"https://github.com/webpack/webpack/blob/v4.20.2/lib/Compiler.js#L536",target:"_blank",rel:"noopener noreferrer"}},[s._v("webpack Compiler.js 第536行"),e("OutboundLink")],1),s._v(" "),e("code",[s._v("build")]),s._v(" 调用 "),e("code",[s._v("this.hooks.make.callAsync(compilation, err => {")]),e("br"),s._v("\n会"),e("strong",[s._v("额外触发")]),s._v("我们这里的实现。")]),s._v(" "),e("p",[s._v("因为它是异步的，所以我们最后要调用 "),e("code",[s._v("callback")]),s._v(" 来完成调用。")]),s._v(" "),e("p",[s._v("**")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("compiler.hooks.make.tapAsync('TestPlugin', (compilation, callback) => {\n    ...\n    \n    callback();\n});\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("p",[e("strong",[s._v("（2）compilation.hooks.buildModule.tap")]),e("br"),s._v(" "),e("code",[s._v("compilation.hooks.buildModule.tap")]),s._v(" 实现了"),e("code",[s._v("compilation.hooks.buildModule")]),s._v("，"),e("br"),s._v("\n它会在"),e("a",{attrs:{href:"https://github.com/webpack/webpack/blob/v4.20.2/lib/Compilation.js#L617",target:"_blank",rel:"noopener noreferrer"}},[s._v("webpack Compilation.js 第617行"),e("OutboundLink")],1),s._v("，"),e("code",[s._v("buildModule")]),s._v("中，"),e("br"),s._v("\n执行"),e("code",[s._v("this.hooks.buildModule.call(module);")]),s._v(" 时被调用。")]),s._v(" "),e("p",[s._v("**")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("buildModule(module, optional, origin, dependencies, thisCallback) {\n    ...\n\n    this.hooks.buildModule.call(module);\n    module.build(\n    ...\n}\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("p",[s._v("因此，通过将"),e("code",[s._v("compiler.hooks")]),s._v("和"),e("code",[s._v("compilation.hooks")]),s._v("的"),e("strong",[s._v("调用和实现分离")]),s._v("，"),e("br"),s._v("\n相当于在webpack执行过程中，添加了多个切面（"),e("a",{attrs:{href:"https://en.wikipedia.org/wiki/Aspect-oriented_programming",target:"_blank",rel:"noopener noreferrer"}},[s._v("面向切面编程AOP"),e("OutboundLink")],1),s._v("）。"),e("br"),s._v("\n在这些切面中，webpack插件可以做自己想做的"),e("strong",[s._v("任何事情")]),s._v("。")]),s._v(" "),e("p",[s._v("以上test-plugin.js插件，我们只是统计了一下，"),e("br"),s._v("\n从"),e("code",[s._v("compilation.buildModule")]),s._v("到"),e("code",[s._v("compilation.succeedModule")]),s._v(" 所经历的时间。")]),s._v(" "),e("p",[e("strong",[s._v("注：")]),s._v(" "),e("code",[s._v("compilation.hooks.succeedModule")]),s._v("在"),e("a",{attrs:{href:"https://github.com/webpack/webpack/blob/v4.20.2/lib/Compilation.js#L652",target:"_blank",rel:"noopener noreferrer"}},[s._v("Compilation.js 第652行"),e("OutboundLink")],1),s._v("调用。")]),s._v(" "),e("p",[s._v("**")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("this.hooks.succeedModule.call(module);\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h4",{attrs:{id:"_2-2-在webpack-config-js中使用插件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-在webpack-config-js中使用插件"}},[s._v("#")]),s._v(" 2.2 在webpack.config.js中使用插件")]),s._v(" "),e("p",[s._v("**")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("const path = require('path');\nconst TestPlugin = require('./test-plugin');\n\nmodule.exports = {\n    entry: {\n        index: path.resolve(__dirname, 'src/index.js'),\n    },\n    output: {\n        path: path.resolve(__dirname, 'dist/'),\n    },\n    module: {\n        rules: [\n            { test: /.js$/, use: { loader: 'babel-loader', query: { presets: ['@babel/preset-env'] } } },\n        ]\n    },\n    plugins:[\n        new TestPlugin(),\n    ],\n};\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br")])]),e("p",[s._v("我们在webpack.config.js中引入了test-plugin.js，"),e("br"),s._v("\n然后在导出对象中增加了"),e("code",[s._v("plugins")]),s._v("属性。")]),s._v(" "),e("p",[s._v("这样我们的webpack插件就编写完了。")]),s._v(" "),e("h4",{attrs:{id:"_2-3-查看插件的调用效果"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-查看插件的调用效果"}},[s._v("#")]),s._v(" 2.3 查看插件的调用效果")]),s._v(" "),e("p",[s._v("直接调用"),e("code",[s._v("npm run build")]),s._v("，")]),s._v(" "),e("p",[s._v("**")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("$ npm run build\nmodule.resource ~/Test/debug-webpack/src/index.js\nmodule.loaders [ { options: { presets: [Array] },\n    ident: 'ref--4',\n    loader: '~/Test/debug-webpack/node_modules/_babel-loader@8.0.4@babel-loader/lib/index.js' } ]\nTestPlugin: 213.301ms\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("p",[s._v("我们统计出来，build ./src/index.js 源文件，"),e("br"),s._v("\n从"),e("code",[s._v("compilation.hooks.buildModule")]),s._v("到"),e("code",[s._v("compilation.hooks.succeedModule")]),s._v("，"),e("br"),s._v("\n总共花费了 "),e("code",[s._v("213.301ms")]),s._v("。")]),s._v(" "),e("h3",{attrs:{id:"_3-tapable"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-tapable"}},[s._v("#")]),s._v(" 3. Tapable")]),s._v(" "),e("p",[s._v("上文中我们通过hooks的用例，了解了它的使用方式，"),e("br"),s._v("\n它为Compiler和Compilation两个类实现了多个切面，"),e("br"),s._v("\n下面我们来看一下原理。")]),s._v(" "),e("p",[s._v("我们打开Compiler类的源码，位于"),e("a",{attrs:{href:"https://github.com/webpack/webpack/blob/v4.20.2/lib/Compiler.js#L40",target:"_blank",rel:"noopener noreferrer"}},[s._v("Compiler.js 第40行"),e("OutboundLink")],1),s._v("，"),e("br"),s._v("\n它是"),e("code",[s._v("Tapable")]),s._v("的子类，它是从tapable模块中导出的，"),e("br"),s._v(" "),e("a",{attrs:{href:"https://github.com/webpack/tapable/tree/v1.1.0",target:"_blank",rel:"noopener noreferrer"}},[s._v("tapable"),e("OutboundLink")],1),s._v("是一个独立的代码库（v1.1.0）。")]),s._v(" "),e("p",[s._v("直接阅读tapable源码会发现非常难懂，"),e("br"),s._v(" "),e("a",{attrs:{href:"https://github.com/webpack/tapable/blob/v1.1.0/lib/HookCodeFactory.js#L19",target:"_blank",rel:"noopener noreferrer"}},[s._v("HookCodeFactory.js"),e("OutboundLink")],1),s._v(" 中使用了大量的"),e("strong",[s._v("元编程")]),s._v("手段"),e("code",[s._v("new Function")]),s._v("。")]),s._v(" "),e("p",[s._v("**")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('fn = new Function(\n    this.args(),\n    \'"use strict";\\n\' +\n    this.header() +\n    this.content({\n        onError: err => `throw ${err};\\n`,\n        onResult: result => `return ${result};\\n`,\n        onDone: () => "",\n        rethrowIfPossible: true\n    })\n);\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br")])]),e("p",[s._v("我认为在这种情况下，要想更好的理解它，最好的办法是从"),e("strong",[s._v("动机")]),s._v("入手，"),e("br"),s._v("\n在tapable仓库"),e("a",{attrs:{href:"https://github.com/webpack/tapable/blob/v1.1.0/README.md#interception",target:"_blank",rel:"noopener noreferrer"}},[s._v("README.md"),e("OutboundLink")],1),s._v("中，"),e("br"),s._v("\n我们看到，tapable实现了"),e("strong",[s._v("interception")]),s._v("（拦截器）。")]),s._v(" "),e("p",[s._v("**")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("const { SyncHook } = require('tapable');\n\nconst hook = new SyncHook(['x', 'y']);\n\nhook.intercept({\n    register(...args) {\n        console.log('2. in: register', args);\n    },\n    call(...args) {\n        console.log('4. in: call', args);\n    },\n});\n\nconsole.log('1. start: register');\nhook.tap('some-message', (...args) => {\n    console.log('5. in: tap', args);\n});\n\nconsole.log('3. start: call');\nhook.call(1, 2, 3);\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br")])]),e("p",[s._v("日志信息如下，")]),s._v(" "),e("p",[s._v("**")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("1. start: register\n2. in: register [ { type: 'sync', fn: [Function], name: 'some-message' } ]\n3. start: call\n4. in: call [ 1, 2 ]\n5. in: tap [ 1, 2 ]\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br")])]),e("p",[e("strong",[s._v("注：")]),e("br"),s._v("\nhooks在构造时设置了两个参数（"),e("code",[s._v("x")]),s._v("和"),e("code",[s._v("y")]),s._v("），"),e("br"),s._v("\n但是在调用时用了三个参数（"),e("code",[s._v("1")]),s._v("，"),e("code",[s._v("2")]),s._v("和"),e("code",[s._v("3")]),s._v("），结果第三个参数丢失了。")]),s._v(" "),e("p",[s._v("我们看到，每一个hooks在被调用的时候它都可以拦截到，被添加新的实现时也是如此。"),e("br"),s._v("\n我们知道"),e("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Proxy",target:"_blank",rel:"noopener noreferrer"}},[s._v("ES6 proxy"),e("OutboundLink")],1),s._v("也可以用来实现拦截功能，"),e("br"),s._v("\n但是IE却一直是"),e("a",{attrs:{href:"https://caniuse.com/#search=proxy",target:"_blank",rel:"noopener noreferrer"}},[s._v("不支持"),e("OutboundLink")],1),s._v("的。")]),s._v(" "),e("p",[s._v("因此，tapable中采用了"),e("strong",[s._v("兼容性")]),s._v("的做法，对实现hooks的代码进行了动态修改，"),e("br"),s._v("\n在其前后增加了拦截器，最后再通过"),e("code",[s._v("new Function")]),s._v("生成一个函数。")]),s._v(" "),e("p",[s._v("具体的源码解析，我们以后慢慢补充。")]),s._v(" "),e("hr"),s._v(" "),e("h3",{attrs:{id:"参考"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[s._v("#")]),s._v(" 参考")]),s._v(" "),e("p",[e("a",{attrs:{href:"https://webpack.js.org/concepts/plugins/",target:"_blank",rel:"noopener noreferrer"}},[s._v("webpack: plugins"),e("OutboundLink")],1),e("br"),s._v(" "),e("a",{attrs:{href:"https://en.wikipedia.org/wiki/Aspect-oriented_programming",target:"_blank",rel:"noopener noreferrer"}},[s._v("Aspect-oriented programming"),e("OutboundLink")],1),e("br"),s._v(" "),e("a",{attrs:{href:"https://github.com/webpack/tapable/tree/v1.1.0",target:"_blank",rel:"noopener noreferrer"}},[s._v("tapable v1.1.0"),e("OutboundLink")],1)])])}),[],!1,null,null,null);e.default=r.exports}}]);