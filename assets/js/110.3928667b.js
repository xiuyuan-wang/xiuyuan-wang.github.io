(window.webpackJsonp=window.webpackJsonp||[]).push([[110],{309:function(e,a,s){"use strict";s.r(a);var n=s(14),r=Object(n.a)({},(function(){var e=this,a=e._self._c;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("p",[e._v("学习源码的一个好办法就是，跟进源码的逻辑中，看看流程是怎么样流转的，"),a("br"),e._v("\n这需要我们有直接"),a("strong",[e._v("debug")]),e._v("代码的能力，"),a("br"),e._v("\n有时候还需要我们在某些关键位置"),a("strong",[e._v("写入log")]),e._v("。")]),e._v(" "),a("p",[e._v("下面我们从"),a("code",[e._v("npm run build")]),e._v(" 命令行工具开始，想办法debug进webpack中，"),a("br"),e._v("\n然后在关键位置写入log。")]),e._v(" "),a("h3",{attrs:{id:"_1-npm-scripts"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-npm-scripts"}},[e._v("#")]),e._v(" 1. npm scripts")]),e._v(" "),a("p",[e._v("上一篇中，我们在命令行中调用"),a("code",[e._v("npm run build")]),e._v("，"),a("br"),e._v("\n源码就被自动的编译打包，然后结果输出到了 ./dist/index.js 文件中了。")]),e._v(" "),a("p",[e._v("**")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("$ npm run build\n\n> debug-webpack@1.0.0 build ~/Test/debug-webpack\n> webpack\n\nHash: 2e91628041d9a877f709\nVersion: webpack 4.20.2\nTime: 639ms\nBuilt at: 2018-10-09 09:25:24\n   Asset       Size  Chunks             Chunk Names\nindex.js  937 bytes       0  [emitted]  index\nEntrypoint index = index.js\n[0] ./src/index.js 8 bytes {0} [built]\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br"),a("span",{staticClass:"line-number"},[e._v("12")]),a("br"),a("span",{staticClass:"line-number"},[e._v("13")]),a("br")])]),a("p",[e._v("可是，这到底发生了什么呢？")]),e._v(" "),a("h4",{attrs:{id:"_1-1-npm-run-build"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-npm-run-build"}},[e._v("#")]),e._v(" 1.1 npm run build")]),e._v(" "),a("p",[a("img",{attrs:{src:"https://images.weserv.nl/?url=upload-images.jianshu.io/upload_images/1023733-6d56b31405723766.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/227/format/webp",alt:""}})]),e._v(" "),a("p",[e._v("上一篇中我们在npm scripts配置了"),a("code",[e._v("npm run build")]),e._v("命令，")]),e._v(" "),a("p",[e._v("**")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('{\n    ...,\n    "scripts:": {\n        ...,\n        "build": "webpack"\n    }\n    ...,\n}\n')])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br")])]),a("p",[e._v("通过查看"),a("a",{attrs:{href:"https://docs.npmjs.com/cli/run-script#description",target:"_blank",rel:"noopener noreferrer"}},[e._v("npm-run-script"),a("OutboundLink")],1),e._v("文档，我们知道，"),a("br"),e._v(" "),a("code",[e._v("npm run")]),e._v("会自动添加"),a("code",[e._v("node_module/.bin")]),e._v(" 到当前命令所用的"),a("code",[e._v("PATH")]),e._v("变量中，"),a("br"),e._v("\n因此，"),a("code",[e._v("npm run build")]),e._v(" 实际会调用 "),a("code",[e._v("node_modules/.bin/webpack")]),e._v("。")]),e._v(" "),a("p",[e._v("**")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("$ node_modules/.bin/webpack\nHash: 2070b107dceedfc63c72\nVersion: webpack 4.20.2\nTime: 334ms\nBuilt at: 2018-10-09 10:13:05\n   Asset       Size  Chunks             Chunk Names\nindex.js  930 bytes       0  [emitted]  index\nEntrypoint index = index.js\n[0] ./src/index.js 10 bytes {0} [built]\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br")])]),a("p",[e._v("与执行npm run build 效果一样。")]),e._v(" "),a("h4",{attrs:{id:"_1-2-显示原身"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-显示原身"}},[e._v("#")]),e._v(" 1.2 显示原身")]),e._v(" "),a("p",[a("img",{attrs:{src:"https://images.weserv.nl/?url=upload-images.jianshu.io/upload_images/1023733-b2cbff1bbb855047.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/511/format/webp",alt:""}})]),e._v(" "),a("p",[e._v("我在Finder中打开这个文件看了下，发现它是一个软链接（"),a("a",{attrs:{href:"https://en.wikipedia.org/wiki/Symbolic_link",target:"_blank",rel:"noopener noreferrer"}},[e._v("symbolic link"),a("OutboundLink")],1),e._v("），"),a("br"),e._v("\n于是，我们还要看看它的"),a("strong",[e._v("原身")]),e._v("在哪里。")]),e._v(" "),a("p",[e._v("**")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("$ l ~/.nvm/versions/node/v8.12.0/bin/webpack\nlrwxr-xr-x  1 用户名  staff    41B 10 24 09:50 node_modules/.bin/webpack -> ../_webpack@4.20.2@webpack/bin/webpack.js\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])]),a("p",[e._v("我们看到它的原身在这里，")]),e._v(" "),a("p",[e._v("**")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("../_webpack@4.20.2@webpack/bin/webpack.js\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("完整路径如下，")]),e._v(" "),a("p",[e._v("**")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("~/Test/debug-webpack/node_modules/_webpack@4.20.2@webpack/bin/webpack.js\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("这就是我们在node_modules中安装的webpack模块的文件地址。")]),e._v(" "),a("p",[e._v("我们来看看代码，"),a("br"),e._v(" "),a("a",{attrs:{href:"https://github.com/webpack/webpack/blob/v4.20.2/bin/webpack.js",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://github.com/webpack/webpack/blob/v4.20.2/bin/webpack.js"),a("OutboundLink")],1)]),e._v(" "),a("p",[e._v("**")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("#!/usr/bin/env node\n\nprocess.exitCode = 0;\n\n/**\n * @param {string} command process to run\n * @param {string[]} args commandline arguments\n * @returns {Promise<void>} promise\n */\nconst runCommand = \n...\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br")])]),a("p",[e._v("以上链接是webpack github仓库的地址，我已经找到了tag为4.20.2的版本位置，"),a("br"),e._v("\n它展示了4.20.2版本的webpack，./bin/webpack.js的源代码。"),a("br"),e._v("\n后文中我们可以使用这样的方式展示源代码了。")]),e._v(" "),a("h4",{attrs:{id:"_1-3-shebang"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-shebang"}},[e._v("#")]),e._v(" 1.3 Shebang")]),e._v(" "),a("p",[e._v("我们注意到了，./bin/webpack.js 文件头有一行这样的代码，")]),e._v(" "),a("p",[e._v("**")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("#!/usr/bin/env node\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("它被称为 "),a("a",{attrs:{href:"https://en.wikipedia.org/wiki/Shebang_(Unix)",target:"_blank",rel:"noopener noreferrer"}},[e._v("Shebang"),a("OutboundLink")],1),e._v("。")]),e._v(" "),a("p",[e._v("在类Unix系统中，包含Shebang的文本，如果作为可执行文件调用，"),a("br"),e._v(" "),a("code",[e._v("#!")]),e._v("后面指定的解释器将会被调用，用来执行后面的代码。")]),e._v(" "),a("p",[e._v("Shebang 语法如下，")]),e._v(" "),a("p",[e._v("**")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("#!interpreter [optional-arg]\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[a("strong",[e._v("注：")]),a("br"),e._v(" "),a("code",[e._v("/usr/bin/env")]),e._v(" 不是一个路径，而是一个命令，"),a("br"),e._v("\n后面跟"),a("code",[e._v("node")]),e._v(" 参数，就会找到node并调用它，"),a("br"),e._v("\n我们来试试，")]),e._v(" "),a("p",[e._v("**")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("$ /usr/bin/env node --version\nv8.12.0\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])]),a("h3",{attrs:{id:"_2-写入日志"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-写入日志"}},[e._v("#")]),e._v(" 2. 写入日志")]),e._v(" "),a("p",[e._v("上文中，我们了解到，"),a("br"),e._v(" "),a("code",[e._v("npm run build")]),e._v("最终导致node解释执行了 ./bin/webpack.js 文件。"),a("br"),e._v("\n由于Node.js是解释型语言，所以，我们可以直接修改源码，来查看更改效果。")]),e._v(" "),a("p",[e._v("一般而言，最常见的"),a("strong",[e._v("写日志")]),e._v("的方法是直接使用"),a("code",[e._v("console.log")]),e._v(" ，"),a("br"),e._v("\n但是我们发现，控制台还输出了其他的文本，"),a("br"),e._v("\n我们很难找到自己输出的信息。")]),e._v(" "),a("p",[e._v("为了展示方便，我决定使用 "),a("a",{attrs:{href:"https://github.com/visionmedia/debug",target:"_blank",rel:"noopener noreferrer"}},[e._v("debug"),a("OutboundLink")],1),e._v(" 模块来输出信息，"),a("br"),e._v("\n它是一个日志库，可以用颜色来区分不同的日志，"),a("br"),e._v("\n看看github仓库中的官方截图，")]),e._v(" "),a("p",[a("img",{attrs:{src:"https://images.weserv.nl/?url=upload-images.jianshu.io/upload_images/1023733-89bf5007bce04afd.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/1200/format/webp",alt:""}})]),e._v(" "),a("h4",{attrs:{id:"_2-1-安装debug为devdependencies"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-安装debug为devdependencies"}},[e._v("#")]),e._v(" 2.1 安装debug为devDependencies")]),e._v(" "),a("p",[e._v("./bin/webpack.js 位于 ~/Test/debug-webpack/node_modules/_webpack@4.20.2@webpack 文件夹中，"),a("br"),e._v("\n我们进入这个文件夹，然后安装debug，")]),e._v(" "),a("p",[e._v("**")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("$ cd ~/Test/debug-webpack/node_modules/_webpack@4.20.2@webpack\n$ npm i -D debug\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br")])]),a("h4",{attrs:{id:"_2-2-使用debug"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-使用debug"}},[e._v("#")]),e._v(" 2.2 使用debug")]),e._v(" "),a("p",[e._v("在 ./bin/webpack.js 文件头部调用debug，这里我们创建了一个"),a("code",[e._v("log")]),e._v("变量。")]),e._v(" "),a("p",[e._v("**")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("#!/usr/bin/env node\nconst log = require('debug')('debug-webpack webpack webpack.js');\n\n...\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br")])]),a("p",[e._v("记得要放到 "),a("code",[e._v("#!/usr/bin/env node")]),e._v(" 后面，"),a("br"),e._v("\n其中第二个参数"),a("code",[e._v("debug-webpack webpack webpack.js")]),e._v(" 称为"),a("a",{attrs:{href:"https://github.com/visionmedia/debug#namespace-colors",target:"_blank",rel:"noopener noreferrer"}},[e._v("namespace"),a("OutboundLink")],1),e._v(" ，可用于区分日志的"),a("strong",[e._v("颜色")]),e._v("，"),a("br"),e._v("\n这里我们为整个文件使用了相同的namespace。")]),e._v(" "),a("h4",{attrs:{id:"_2-3-bin-webpack-js-代码逻辑"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-bin-webpack-js-代码逻辑"}},[e._v("#")]),e._v(" 2.3 bin/webpack.js 代码逻辑")]),e._v(" "),a("p",[a("img",{attrs:{src:"https:https://upload-images.jianshu.io/upload_images/1023733-15a6ad920309c488.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/512/format/webp",alt:""}})]),e._v(" "),a("p",[e._v("通过阅读 ./bin/webpack.js 源码，我们发现，"),a("br"),e._v("\n它首先会对已安装的CLI进行检查，然后会载入安装的CLI工具。"),a("br"),e._v("\nwebpack要求我们必须安装"),a("a",{attrs:{href:"https://github.com/webpack/webpack-cli",target:"_blank",rel:"noopener noreferrer"}},[e._v("webpack-cli"),a("OutboundLink")],1),e._v(" 或 "),a("a",{attrs:{href:"https://github.com/webpack-contrib/webpack-command",target:"_blank",rel:"noopener noreferrer"}},[e._v("webpack-command"),a("OutboundLink")],1),e._v(" 之一，否则就会报错。")]),e._v(" "),a("p",[e._v("**")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("if (installedClis.length === 0) {\n    // 报错\n}\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br")])]),a("p",[e._v("源码位置如下："),a("a",{attrs:{href:"https://github.com/webpack/webpack/blob/v4.20.2/bin/webpack.js#L84",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://github.com/webpack/webpack/blob/v4.20.2/bin/webpack.js#L84"),a("OutboundLink")],1)]),e._v(" "),a("p",[e._v("如果我们已经安装了某一个CLI的话，就会加载这个CLI，源码"),a("a",{attrs:{href:"https://github.com/webpack/webpack/blob/v4.20.2/bin/webpack.js#L149-L159",target:"_blank",rel:"noopener noreferrer"}},[e._v("第149-159行"),a("OutboundLink")],1),e._v("，")]),e._v(" "),a("p",[e._v("**")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('else if (installedClis.length === 1) {\n    const path = require("path");\n    const pkgPath = require.resolve(`${installedClis[0].package}/package.json`);\n    // eslint-disable-next-line node/no-missing-require\n    const pkg = require(pkgPath);\n    // eslint-disable-next-line node/no-missing-require\n    require(path.resolve(\n        path.dirname(pkgPath),\n        pkg.bin[installedClis[0].binName]\n    ));\n}\n')])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br")])]),a("p",[e._v("注意以上代码第"),a("code",[e._v("7")]),e._v("行，webpack动态 "),a("code",[e._v("require")]),e._v("了一个地址，"),a("br"),e._v("\n这时候我们的"),a("code",[e._v("log")]),e._v(" 工具就有用武之地了。")]),e._v(" "),a("p",[e._v("**")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("const cliPath = path.resolve(path.dirname(pkgPath), pkg.bin[installedClis[0].binName]);\nlog('cliPath: %s', cliPath);\nrequire(cliPath);\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br")])]),a("h4",{attrs:{id:"_2-3-查看日志"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-查看日志"}},[e._v("#")]),e._v(" 2.3 查看日志")]),e._v(" "),a("p",[e._v("直接按原样调用"),a("code",[e._v("npm run build")]),e._v("是看不到刚才写入的日志信息的，"),a("br"),e._v("\n我们还需要传入"),a("strong",[e._v("前置参数")]),e._v("，")]),e._v(" "),a("p",[e._v("**")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("$ DEBUG=debug-webpack* npm run build\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("blockquote",[a("p",[e._v("The environment for any simple command or function may be augmented temporarily by prefixing it with parameter assignments, as described > in Shell Parameters. These assignment statements affect only the environment seen by that command."),a("br"),e._v("\n—— "),a("a",{attrs:{href:"https://www.gnu.org/software/bash/manual/bashref.html#Environment",target:"_blank",rel:"noopener noreferrer"}},[e._v("Bash Reference Manual - 3.7.4 Environment"),a("OutboundLink")],1)])]),e._v(" "),a("p",[e._v("其中名为"),a("code",[e._v("DEBUG")]),e._v("的前置参数，是 "),a("a",{attrs:{href:"https://github.com/visionmedia/debug",target:"_blank",rel:"noopener noreferrer"}},[e._v("debug"),a("OutboundLink")],1),e._v(" 模块所需要的，"),a("br"),e._v(" "),a("code",[e._v("debug-webpack*")]),e._v(" 表示我们要输出所有以"),a("code",[e._v("debug-webpack")]),e._v(" 开头"),a("strong",[e._v("namespace")]),e._v("中的日志。"),a("br"),e._v("\n我们示例中，"),a("strong",[e._v("namespace")]),e._v("是"),a("code",[e._v("debug-webpack webpack webpack.js")]),e._v("。")]),e._v(" "),a("p",[e._v("运行结果如下，")]),e._v(" "),a("p",[e._v("**")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("debug-webpack webpack webpack.js cliPath: ~/Test/debug-webpack/node_modules/_webpack-cli@3.1.2@webpack-cli/bin/cli.js +0ms\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://images.weserv.nl/?url=upload-images.jianshu.io/upload_images/1023733-f3890c0e105f45d7.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/491/format/webp",alt:""}})]),e._v(" "),a("h3",{attrs:{id:"_3-webpack-cli-bin-cli-js"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_3-webpack-cli-bin-cli-js"}},[e._v("#")]),e._v(" 3. webpack-cli/bin/cli.js")]),e._v(" "),a("p",[a("img",{attrs:{src:"https://images.weserv.nl/?url=upload-images.jianshu.io/upload_images/1023733-83e5cafcf955311f.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/511/format/webp",alt:""}})]),e._v(" "),a("p",[e._v("上文中我们得到了webpack "),a("code",[e._v("require")]),e._v("的CLI地址，")]),e._v(" "),a("p",[e._v("**")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("~/Test/debug-webpack/node_modules/_webpack-cli@3.1.2@webpack-cli/bin/cli.js\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("源码位于，"),a("a",{attrs:{href:"https://github.com/webpack/webpack-cli/blob/v3.1.2/bin/cli.js",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://github.com/webpack/webpack-cli/blob/v3.1.2/bin/cli.js"),a("OutboundLink")],1),a("br"),e._v("\nwebpack-cli版本为 "),a("strong",[e._v("v3.1.2")]),e._v("。")]),e._v(" "),a("p",[e._v("分析源码我们发现，代码中第436行"),a("code",[e._v("require")]),e._v("了"),a("code",[e._v("webpack")]),e._v("模块，"),a("br"),e._v(" "),a("a",{attrs:{href:"https://github.com/webpack/webpack-cli/blob/v3.1.2/bin/cli.js#L436",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://github.com/webpack/webpack-cli/blob/v3.1.2/bin/cli.js#L436"),a("OutboundLink")],1)]),e._v(" "),a("p",[e._v("**")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v('const webpack = require("webpack");\n')])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("随后在第441行，调用"),a("code",[e._v("webpack")]),e._v("，返回了一个"),a("code",[e._v("compiler")]),e._v("，"),a("br"),e._v(" "),a("a",{attrs:{href:"https://github.com/webpack/webpack-cli/blob/v3.1.2/bin/cli.js#L441",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://github.com/webpack/webpack-cli/blob/v3.1.2/bin/cli.js#L441"),a("OutboundLink")],1)]),e._v(" "),a("p",[e._v("**")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("compiler = webpack(options);\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[e._v("最后，在第533行，调用了"),a("code",[e._v("compiler.run")]),e._v("，"),a("br"),e._v(" "),a("a",{attrs:{href:"https://github.com/webpack/webpack-cli/blob/v3.1.2/bin/cli.js#L533",target:"_blank",rel:"noopener noreferrer"}},[e._v("https://github.com/webpack/webpack-cli/blob/v3.1.2/bin/cli.js#L533"),a("OutboundLink")],1)]),e._v(" "),a("p",[e._v("**")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("} else compiler.run(compilerCallback);\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://images.weserv.nl/?url=upload-images.jianshu.io/upload_images/1023733-b76c151bf9a7f764.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/511/format/webp",alt:""}})]),e._v(" "),a("h3",{attrs:{id:"_4-开始debug"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#_4-开始debug"}},[e._v("#")]),e._v(" 4. 开始debug")]),e._v(" "),a("p",[e._v("知道了webpack-cli的代码逻辑之后，我们就可以创建一个debug.js脚本来模拟webpack-cli调用了，"),a("br"),e._v("\n在我们上一篇"),a("a",{attrs:{href:"https://www.jianshu.com/p/2fa6562210ef",target:"_blank",rel:"noopener noreferrer"}},[e._v("debug-webpack"),a("OutboundLink")],1),e._v("示例项目中，添加一个./debug.js 文件，")]),e._v(" "),a("p",[e._v("**")]),e._v(" "),a("div",{staticClass:"language- line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-text"}},[a("code",[e._v("const webpack = require('webpack');\nconst options = require('./webpack.config');\n\nconst compiler = webpack(options);\n\ncompiler.run((...args) => {\n    console.log(...args);\n});\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br")])]),a("p",[e._v("保持这个文件打开状态，在以上代码第"),a("code",[e._v("6")]),e._v("行位置打个断点，"),a("br"),e._v("\n然后在vscode中按 "),a("code",[e._v("F5")]),e._v("（或者点击左侧调试面板，再点击调试）。")]),e._v(" "),a("p",[a("img",{attrs:{src:"https://images.weserv.nl/?url=upload-images.jianshu.io/upload_images/1023733-5fe7c6e75340c49a.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/473/format/webp",alt:""}})]),e._v(" "),a("p",[e._v("代码就停在我们的断点位置上了。")]),e._v(" "),a("p",[e._v("然后我们可以点击左数第3个按钮，进行单步调试，就可以进入"),a("code",[e._v("compiler.run")]),e._v("方法中了。")]),e._v(" "),a("p",[a("img",{attrs:{src:"https://images.weserv.nl/?url=upload-images.jianshu.io/upload_images/1023733-fd6862a470ebc1ee.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/257/format/webp",alt:""}})]),e._v(" "),a("hr"),e._v(" "),a("h3",{attrs:{id:"参考"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[e._v("#")]),e._v(" 参考")]),e._v(" "),a("p",[a("a",{attrs:{href:"https://github.com/visionmedia/debug",target:"_blank",rel:"noopener noreferrer"}},[e._v("github: debug"),a("OutboundLink")],1),a("br"),e._v(" "),a("a",{attrs:{href:"https://github.com/webpack/webpack/blob/v4.20.2/bin/webpack.js",target:"_blank",rel:"noopener noreferrer"}},[e._v("github: webpack v4.20.2 ./bin/webpack.js"),a("OutboundLink")],1),a("br"),e._v(" "),a("a",{attrs:{href:"https://github.com/webpack/webpack-cli/blob/v3.1.2/bin/cli.js",target:"_blank",rel:"noopener noreferrer"}},[e._v("github: webpack-cli v3.1.2 ./bin/cli.js"),a("OutboundLink")],1),a("br"),e._v(" "),a("a",{attrs:{href:"https://code.visualstudio.com/docs/editor/debugging",target:"_blank",rel:"noopener noreferrer"}},[e._v("Debugging in Visual Studio Code"),a("OutboundLink")],1)])])}),[],!1,null,null,null);a.default=r.exports}}]);